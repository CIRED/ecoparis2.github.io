(function(e){function t(t){for(var n,s,i=t[0],l=t[1],c=t[2],d=0,p=[];d<i.length;d++)s=i[d],r[s]&&p.push(r[s][0]),r[s]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);u&&u(t);while(p.length)p.shift()();return o.push.apply(o,c||[]),a()}function a(){for(var e,t=0;t<o.length;t++){for(var a=o[t],n=!0,i=1;i<a.length;i++){var l=a[i];0!==r[l]&&(n=!1)}n&&(o.splice(t--,1),e=s(s.s=a[0]))}return e}var n={},r={app:0},o=[];function s(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=e,s.c=n,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(a,n,function(t){return e[t]}.bind(null,n));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],l=i.push.bind(i);i.push=t,i=i.slice();for(var c=0;c<i.length;c++)t(i[c]);var u=l;o.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"0466":function(e,t,a){},"054f":function(e,t,a){"use strict";var n=a("fcd1"),r=a.n(n);r.a},"0f8a":function(e,t,a){},"2a3c":function(e,t,a){},"50c4":function(e,t,a){"use strict";var n=a("d05b"),r=a.n(n);r.a},"56d7":function(e,t,a){"use strict";a.r(t);a("cadf"),a("551c"),a("097d");var n=a("2b0e"),r=function(){var e=this,t=this,a=t.$createElement,n=t._self._c||a;return n("div",{attrs:{id:"app"}},[n("transition",{attrs:{name:"fade"}},[t.introVisible?n("Intro",{attrs:{isLoading:!t.currentLayerLoaded},on:{dismiss:function(){return t.introVisible=!1}}}):t._e()],1),t.aboutVisible?n("About",{on:{dismiss:function(){return t.aboutVisible=!1}}}):t._e(),n("section",{staticClass:"menu"},[n("LocationControl",{attrs:{onLocation:function(t){return e.currentLocation=t}}}),n("Layers",{attrs:{layers:t.layers},model:{value:t.currentLayerPath,callback:function(e){t.currentLayerPath=e},expression:"currentLayerPath"}}),n("ZoomControl",{on:{zoomOut:function(){return t.currentZoom-=1},zoomIn:function(){return t.currentZoom+=1}}}),n("a",{staticClass:"about-button",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),function(){return t.aboutVisible=!0}()}}},[t._v("À propos")])],1),n("section",{staticClass:"container"},[n("Map",{attrs:{layers:t.layers,currentLayerPath:t.currentLayerPath,currentLocation:t.currentLocation,currentZoom:t.currentZoom,isFuture:t.isFuture},on:{toggleFuture:function(){return t.isFuture^=!0},newHistogram:function(t,a){e.currentHistogramX=t,e.currentHistogramY=a},newSchools:function(t){return e.schoolCount=t}}}),n("Sidebar",{attrs:{layers:t.layers,currentLayerPath:t.currentLayerPath,currentHistogramX:t.currentHistogramX,currentHistogramY:t.currentHistogramY,schoolCount:t.schoolCount}})],1)],1)},o=[],s=(a("ac6a"),a("456d"),a("7dc5")),i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"intro"},[e._m(0),a("p",[e._v("Découvrez l'influence de la nature sur votre vie à Paris.")]),a("section",{staticClass:"buttons"},[e.isLoading?a("a",{staticClass:"button loading"},[e._v("Chargement")]):a("a",{staticClass:"button",attrs:{href:"#"},on:{click:function(t){t.preventDefault(),e.$emit("dismiss")}}},[e._v("Commencer la visite")])])])},l=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("h1",[e._v("\n    EcoParis\n    "),a("img",{attrs:{src:"assets/parrot.svg"}})])}],c={props:["isLoading"]},u=c,d=(a("91fa"),a("2877")),p=Object(d["a"])(u,i,l,!1,null,null,null);p.options.__file="Intro.vue";var h=p.exports,m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"about-wrapper"},[a("a",{staticClass:"about-close",attrs:{href:"#"},on:{click:function(t){t.preventDefault(),e.$emit("dismiss")}}},[e._v("X")]),e._m(0)])},f=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"about-box"},[a("h2",[e._v("Réalisation et remerciements.")]),a("p",[e._v("EcoParis a été conçu par trois étudiants de l'EPFL pendant le semestre d'automne 2018 dans le cadre du cours de "),a("a",{attrs:{href:"https://edu.epfl.ch/coursebook/en/data-visualization-COM-480"}},[e._v("Data Visualization")]),e._v(".")]),a("ul",[a("li",[e._v("Alex Ferragni, Master d'Informatique")]),a("li",[e._v("Karthigan Sinnathamby, Master en Data Science")]),a("li",[e._v("Romain Liautaud, Master en Systèmes de Communication")])]),a("p",[e._v("Ce projet a été réalisé en colloboration avec "),a("a",{attrs:{href:"https://naturalcapitalproject.stanford.edu/"}},[e._v("Natural Capital Project")]),e._v(" de Stanford dont la mission consiste \n        à développer des approches scientifiques pour mettre en avant les bénéfices de la nature aux yeux de la société dans le but d'incorporer le patrimoine naturel dans la prise de décision.")]),a("p",[e._v("Les données sur les services de rétention des nutriments, recharge des nappes, et pollinisation ont été créées par Emmanuel Fauré pour son "),a("a",{attrs:{href:"https://www.dropbox.com/s/s4ccqoz7yg38sgw/Faure_memoire.pdf?dl=0"}},[e._v("mémoire de thèse de Master")]),e._v(" et restent préliminaires. Le calcul des données ainsi que les limitations sont décrites dans le mémoire.")]),a("p",[e._v("Les données sur le service de rafraîchissement ne sont fournies qu'à titre illustratif, en attendant les résultat des travaux du projet "),a("a",{attrs:{href:"https://idefese.wordpress.com/"}},[e._v("IDEFESE")]),e._v(".\n        Les données sur les "),a("a",{attrs:{href:"http://data.iau-idf.fr/datasets?q=espaces+verts&sort_by=relevance"}},[e._v("espaces verts")]),e._v(" et sur \n        le "),a("a",{attrs:{href:"http://data.iau-idf.fr/datasets?q=r%C3%A9seau+hydrographique+principal+simplifi%C3%A9+d%27%C3%8Ele-de-france&sort_by=relevance"}},[e._v(" réseau hydrographique ")]),e._v(" proviennent de l'IAU Ile-de-France.")]),a("p",[e._v("Nos remerciements à Perrine Hamel, hydrologue du Natural Capital Project, pour la supervision du projet.")]),a("p",[e._v("Le logo du perroquet a été réalisé par "),a("a",{attrs:{href:"https://www.flaticon.com/authors/freepik"}},[e._v("Freepik")]),e._v(" pour "),a("a",{attrs:{href:"http://www.flaticon.com/"}},[e._v("Flaticon")]),e._v(".")])])}],v={},g=v,_=(a("50c4"),Object(d["a"])(g,m,f,!1,null,null,null));_.options.__file="About.vue";var y=_.exports,b=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"zoom-control"},[a("a",{staticClass:"minus",on:{click:function(t){t.preventDefault(),e.$emit("zoomOut")}}},[e._v("-")]),a("a",{staticClass:"plus",on:{click:function(t){t.preventDefault(),e.$emit("zoomIn")}}},[e._v("+")])])},C=[],E={},x=E,w=(a("f27d"),Object(d["a"])(x,b,C,!1,null,null,null));w.options.__file="ZoomControl.vue";var P=w.exports,V=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"location-control"},[a("a",{staticClass:"locate",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.locate(t)}}},[a("i",{staticClass:"fas fa-map-marker-alt"})]),a("div",{class:{search:!0,active:e.searchExpanded}},[a("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.toggleSearch(t)}}},[e.searchExpanded?a("i",{staticClass:"fas fa-search-minus"}):a("i",{staticClass:"fas fa-search-location"})]),a("input",{ref:"searchInput",staticClass:"autocomplete",attrs:{type:"text"},on:{keyup:function(t){if(!("button"in t)&&27!==t.keyCode)return null;e.searchExpanded=!1}}})])])},k=[],j={props:["onLocation"],data:function(){return{searchExpanded:!1}},mounted:function(){var e=this,t=new google.maps.places.Autocomplete(this.$refs.searchInput);t.setFields(["geometry"]),t.setOptions({strictBounds:!0}),t.setBounds({north:s.viewport.topLatitude,south:s.viewport.bottomLatitude,west:s.viewport.leftLongitude,east:s.viewport.rightLongitude}),t.addListener("place_changed",function(){var a=t.getPlace();a.geometry?(e.searchExpanded=!1,e.onLocation([a.geometry.location.lat(),a.geometry.location.lng()])):e.onLocation(null,null)})},methods:{locate:function(){var e=this;navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){t&&e.onLocation([t.coords.latitude,t.coords.longitude])})},toggleSearch:function(){this.searchExpanded^=!0,this.$refs.searchInput.focus()},keypressSearch:function(e){alert(JSON.stringify(e))}}},S=j,I=(a("bed8"),Object(d["a"])(S,V,k,!1,null,null,null));I.options.__file="LocationControl.vue";var M=I.exports,q=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"layers"},[a("h3",[e._v("Couches")]),a("div",{staticClass:"buttons"},e._l(e.layers,function(t){return t.hidden?e._e():a("a",{class:{active:e.value==t.path},on:{click:function(a){a.preventDefault(),e.select(t)}}},[a("span",{staticClass:"icon",domProps:{innerHTML:e._s(t.icon)}}),a("span",[e._v(e._s(t.name))]),t.loaded?e._e():a("div",{staticClass:"loader-tile-grid"},[a("div",{staticClass:"loader-tile loader-tile1"}),a("div",{staticClass:"loader-tile loader-tile2"}),a("div",{staticClass:"loader-tile loader-tile3"}),a("div",{staticClass:"loader-tile loader-tile4"}),a("div",{staticClass:"loader-tile loader-tile5"}),a("div",{staticClass:"loader-tile loader-tile6"}),a("div",{staticClass:"loader-tile loader-tile7"}),a("div",{staticClass:"loader-tile loader-tile8"}),a("div",{staticClass:"loader-tile loader-tile9"})])])}),0)])},F=[],D={props:["layers","value"],methods:{select:function(e){e.loading||this.$emit("input",e.path)}}},O=D,z=(a("054f"),Object(d["a"])(O,q,F,!1,null,null,null));z.options.__file="Layers.vue";var $=z.exports,T=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"map-container"},[a("section",{ref:"map",staticClass:"map"}),a("svg",{ref:"circle_svg",staticClass:"EV-circle-svg"}),a("svg",{ref:"svg",staticClass:"EV-svg"}),e.hasFutureAvailable&&!e.isFuture?a("section",{staticClass:"year"},[a("p",[e._v(e._s(e.currentYear))]),a("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),function(){return e.$emit("toggleFuture")}()}}},[a("i",{staticClass:"fas fa-fast-forward"})])]):e.hasFutureAvailable?a("section",{staticClass:"year"},[a("p",[e._v("2025")]),a("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),function(){return e.$emit("toggleFuture")}()}}},[a("i",{staticClass:"fas fa-fast-backward"})])]):e._e(),a("section",{staticClass:"legend"},[a("div",{ref:"legend",staticClass:"legend-inner"}),e.isEspacesVerts?a("section",[a("h3",[e._v("Espace naturels")]),a("figure",[a("div",{staticClass:"item",style:{backgroundColor:e.forestColor}}),a("figcaption",[e._v("Espaces boisés")])]),a("figure",[a("div",{staticClass:"item",style:{backgroundColor:e.waterColor}}),e._m(0)]),a("figure",[a("div",{staticClass:"item",style:{backgroundColor:e.greenColor}}),e._m(1)])]):e.currentUnit?a("section",[a("p",[e._v("("+e._s(e.currentUnit)+")")])]):e._e()])])},B=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("figcaption",[e._v("Fleuves et "),a("br"),e._v("espaces en eau")])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("figcaption",[e._v("Espaces verts et "),a("br"),e._v("espaces de loisirs")])}],A=a("3835"),H={},Y="",X=null,G=null,N=null,R=null,U=null,Z=null,J=null,K=null,W=null,Q={},ee=null,te=null,ae=null,ne=null,re=[],oe=null,se=null,ie=null,le=null,ce=null,ue=null,de=null,pe=-1,he=null,me={},fe=0,ve=0,ge={cachedLayers:H,currentLayerPath:Y,map:X,currentGeoLat:G,currentGeoLng:N,svg_EV:R,svg_circle_EV:U,interComms:Z,voronoi:J,imgs:K,imgs_EV:W,update_parameters:Q,markerElement:ee,canvas:te,voronoi_shape:ae,interComm_shape:ne,firstVoronoiByInterComm:re,pathGenerator:oe,defs_path:se,legend_element:ie,color_legend_canvas:le,color_legend_svg:ce,onSchools:ue,onHistChange:de,highlightedInterComm:pe,initialBounds:he,markerIcon:me,lastMouseDownX:fe,lastMouseDownY:ve},_e=a("7dc5");function ye(){var e=ge.map,t=ge.cachedLayers,a=ge.currentLayerPath,n=ge.defs_path;function r(n,r){var o=e.latLngToLayerPoint([t[a].tl_lat,t[a].tl_lng]),s=e.latLngToLayerPoint([t[a].br_lat,t[a].br_lng]),i=s.x-o.x,l=s.y-o.y,c=e.latLngToLayerPoint(L.latLng(r,n)),u=(c.x-o.x)/(s.x-o.x)*(i-1),d=(c.y-o.y)/(s.y-o.y)*(l-1);this.stream.point(u,d)}var o=d3.geo.transform({point:r}),s=d3.geo.path().projection(o);n.attr("d",s)}function Le(e,t){var a=ge.svg_EV,n=ge.svg_circle_EV,r=ge.map,o=ge.cachedLayers,s=ge.imgs_EV,i=_e.EV_path;if(o[_e.EV_path]){var l=parseInt(a.style("width").substr(0,a.style("width").length-2)),c=parseInt(a.style("height").substr(0,a.style("width").length-2)),u=parseInt(n.style("width").substr(0,n.style("width").length-2)),d=parseInt(n.style("height").substr(0,n.style("width").length-2));a.attr("style","top:"+(t-c-15)+"px; left:"+(e+15)+"px; display:'';"),ge.svg_circle_EV.attr("style","top:"+(t-d/2)+"px; left:"+(e-u/2)+"px; display:'';");var p=l/u,h=L.latLng(o[i].tl_lat,o[i].tl_lng),m=L.latLng(o[i].br_lat,o[i].br_lng),f=r.latLngToContainerPoint(h),v=(r.latLngToContainerPoint(m),e-f.x),g=t-f.y,_=L.point(e-v*p,t-g*p),y=(r.latLngToLayerPoint(m).x-r.latLngToLayerPoint(h).x)*p,b=(r.latLngToLayerPoint(m).y-r.latLngToLayerPoint(h).y)*p;s.attr("width",y),s.attr("height",b),s.attr("transform","translate("+(+_.x-e+l/2)+","+(+_.y-t+c/2)+")")}}function be(e,t,a){var n=ge.cachedLayers,r=n[t];if(r){var o=[];o=1==a?r.voronoi_hist[e]:r.interComm_hist[e],o[0]=0,ge.onHistChange($e.range(256),o)}}function Ce(e,t,a){var n=ge.cachedLayers;if(t==_e.Urban_cooling){var r=n[_e.Ecole_path];if(!r)return;var o=[];o=1==a?r.voronoi_hist[e].slice(-1).pop():r.interComm_hist[e].slice(-1).pop(),ge.onSchools(o)}else ge.onSchools(null)}function Ee(){var e=ge.map,t=ge.currentGeoLat,a=ge.currentGeoLng,n=ge.markerElement;if(t&&a){var r=e.latLngToLayerPoint([t,a]),o=r.x-ge.markerIcon.iconAnchor[0],s=r.y-ge.markerIcon.iconAnchor[1];n.attr("visibility","visible"),n.attr("transform","translate(".concat(o,", ").concat(s,")"))}else n.attr("visibility","hidden")}function xe(){var e=ge.map,t=(ge.cachedLayers,ge.voronoi),a=ge.interComms,n=ge.imgs,r=ge.imgs_EV,o=ge.update_parameters,s=ge.pathGenerator;if(o.hide)return console.log("hidden!"),a.attr("visibility","hidden"),t.attr("visibility","hidden"),n.attr("visibility","hidden"),void r.attr("visibility","hidden");a.attr("visibility","visible"),t.attr("visibility","visible"),n.attr("visibility","visible"),r.attr("visibility","visible");var i=o.tl,l=o.br;console.log("UPDATING");var c=e.latLngToLayerPoint(l).x-e.latLngToLayerPoint(i).x,u=e.latLngToLayerPoint(l).y-e.latLngToLayerPoint(i).y;n.attr("transform",function(t){var a=e.latLngToLayerPoint(i);return"translate("+a.x+","+a.y+")"}),n.attr("width",c),n.attr("height",u),a.attr("d",s),t.attr("d",s),ye(),Ee(),ge.svg_EV.attr("style","display:none;"),ge.svg_circle_EV.attr("style","display:none;")}var we={update_clip:ye,update_EV_preview:Le,update_chart:be,update_text_school:Ce,updateMarker:Ee,updateMap:xe},Pe={0:d3.interpolateOranges,1:d3.interpolateRdBu,2:d3.interpolateBlues,3:d3.interpolateGnBu,4:d3.interpolateReds};function Ve(e){return fetch(e).then(function(e){return e.json()}).then(function(e){return e.data=JSON.parse(e.data),e})}var ke="https://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.png",je='&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>';function Se(e){ge.map=L.map(e,{zoomControl:!1});var t=ge.map;t.fitBounds(ge.initialBounds),t.setMaxBounds(t.getBounds());var a=L.tileLayer(ke,{minZoom:9,maxZoom:14,attribution:je});a.addTo(t)}function Ie(e){return ge.interComm_shape.features.some(function(t){return d3.geoContains(t,e)})}function Me(e,t){e&&t&&Ie([t,e])?ge.map.setView(new L.LatLng(e,t),11):(e=null,t=null,ge.map.fitBounds(ge.initialBounds)),ge.currentGeoLat=e,ge.currentGeoLng=t,we.updateMarker()}function qe(e){for(var t=Pe[e],a=[],n=0;n<256;++n)a.push(t(n/255));return a}function Fe(e,t,a,n,r){for(var o=200,s=70,i={top:5,right:30,bottom:5,left:0},l=e.attr("height",o-i.top-i.bottom).attr("width",1).style("height",o-i.top-i.bottom+"px").style("width",s-i.left-i.right+"px").style("position","absolute").style("top",i.top+"px").style("left",i.left+"px").node(),c=l.getContext("2d"),u=function(e){return a((o-i.top-i.bottom-e)/(o-i.top-i.bottom)*255)},d=c.createImageData(1,o-i.top-i.bottom),p=0;p<o-i.top-i.bottom;++p){var h=d3.rgb(u(p));d.data[4*p]=h.r,d.data[4*p+1]=h.g,d.data[4*p+2]=h.b,d.data[4*p+3]=255}c.putImageData(d,0,0);var m=d3.axisRight().scale(d3.scaleLinear().domain([r,n]).range([1,o-i.bottom-i.top-1])).tickSize(6).ticks(8),f=t.attr("height","".concat(o,"px")).attr("width","".concat(s,"px")).style("position","absolute").style("left","0px").style("top","0px");f.select("g").attr("class","axis").attr("transform","translate(".concat(s-i.left-i.right,", ").concat(i.top-1,")")).call(m)}function De(e,t){var a=e.slice();a.unshift(0),a.push(255);for(var n=a.length,r=t.length,o=[],s=0;s<r;++s)o[s]=s/(r-1);var i=d3.scale.linear().domain(o).range(t),l=[];for(s=0;s<n;++s){var c=s/(n-1);l.push(i(c))}return[a,l]}function Oe(e){return{opacity:0,fillOpacity:0}}function ze(e){for(var t=[],a=0;a<e;++a)t[a]=a;return t}var $e={loadContainmentFile:Ve,createMap:Se,setLocation:Me,getColorsFromScheme:qe,fillScale:Fe,computeColorRange:De,blankStyle:Oe,range:ze},Te=a("7dc5");function Be(e,t,a){var n=ge.canvas,r=ge.voronoi_shape,o=ge.interComm_shape;if(ge.cachedLayers[e])a();else{var s=e;t&&(s=Te.layers[e].future),fetch(s).then(function(e){return e.json()}).then(function(t){console.log("Preloaded layer:",s),t.data=JSON.parse(t.data),t.percentiles=JSON.parse(t.percentiles);var i=t.data;n.width=t.width,n.height=t.height;var l=n.getContext("2d");l.createImageData(n.width,n.height);for(var c=n.height*n.width,u=1,d=0,p=c/u,h=n.height/u,m=[],f=[],v={},g=0;g<r.features.length;++g){f[g]=0,m[g]=0,v[g]=[];for(var _=0;_<256;++_)v[g][_]=0}var y=[],L=[],b={};for(g=0;g<o.features.length;++g){L[g]=0,y[g]=0,b[g]=[];for(_=0;_<256;++_)b[g][_]=0}ge.firstVoronoiByInterComm=[];var C=ge.firstVoronoiByInterComm;for(g=0;g<o.features.length;++g)C[g]=1e4;var E=function(i){for(var c=i.data.result,p=i.data.index,g=i.data.interComm_counts,_=i.data.interComm_means,E=i.data.voronoi_counts,x=i.data.voronoi_means,w=i.data.firstVoronoiByInterComm,P=i.data.voronoi_hist,V=i.data.interComm_hist,k=0;k<r.features.length;++k){f[k]+=E[k],m[k]+=x[k];for(var j=0;j<256;++j)v[k][j]+=P[k][j]}for(k=0;k<o.features.length;++k){L[k]+=g[k],y[k]+=_[k];for(j=0;j<256;++j)b[k][j]+=V[k][j];C[k]>w[k]&&(C[k]=w[k])}if(l.putImageData(c,0,h*p),d++,d==u){if(e==Te.Ecole_path){for(k=0;k<r.features.length;++k)m[k]/=255;for(k=0;k<o.features.length;++k)y[k]/=255}else{for(k=0;k<r.features.length;++k)0!=f[k]&&(m[k]/=f[k]);for(k=0;k<o.features.length;++k)0!=L[k]&&(y[k]/=L[k])}var S=[70,140],I=n.toDataURL("png");ge.cachedLayers[s]={url:I,tl_lat:t.tl_lat,tl_lng:t.tl_lng,br_lat:t.br_lat,br_lng:t.br_lng,width:n.width,height:n.height,voronoi_means:m,interComm_means:y,voronoi_hist:v,interComm_hist:b,hist_buckets:S,percentiles:t.percentiles,layerUrl:s},console.log("Processed layer:",s),a()}},x=$e.range(256),w=[];if(Te.layers[e]&&Te.layers[e].useColorScheme)w=$e.getColorsFromScheme(Te.layers[e].colorScheme);else{var P=$e.computeColorRange(t.percentiles,Te.layers[e].colors),V=P[0],k=P[1],j=d3.scale.linear().range(k).domain(V);for(g=0;g<256;++g){var S=d3.rgb(j(g));w.push("rgb("+S.r+","+S.g+","+S.b+")")}}$e.loadContainmentFile("data/voronoi_cont.json").then(function(e){$e.loadContainmentFile("data/intercomm_cont.json").then(function(a){for(var s=0;s<u;s++){var c=new Worker("assets/pictureProcessor.js");c.onmessage=E;var d=l.getImageData(0,h*s,n.width,h);c.postMessage({canvasData:d,pixels:i,index:s,length:p,width:n.width,height:n.height,voronoiContainmentData:e.data,interCommContainmentData:a.data,numVoronois:r.features.length,numInterComms:o.features.length,tl_lat:t.tl_lat,tl_lng:t.tl_lng,br_lat:t.br_lat,br_lng:t.br_lng,colorDomain:x,colorRange:w})}})})})}}function Ae(e,t){var a=ge.update_parameters,n=ge.imgs;if(!e)return a.hide=!0,void we.updateMap();var r=e;t&&(r=Te.layers[e].future),this.loadLayer(e,t,function(){e==Te.EV_path?n.attr("clip-path",""):n.attr("clip-path","url(#clip)");var t=ge.cachedLayers[r];a.tl=new L.LatLng(t.tl_lat,t.tl_lng),a.br=new L.LatLng(t.br_lat,t.br_lng),a.currentGeoLat=ge.currentGeoLat,a.currentGaoLng=ge.currentGeoLng;var o=[],s=[];if(Te.layers[e].useColorScheme)o=$e.range(256),s=$e.getColorsFromScheme(Te.layers[e].colorScheme);else{var i=$e.computeColorRange(t.percentiles,Te.layers[e].colors);o=i[0],s=i[1]}var l=d3.scale.linear().range(s).domain(o);ge.voronoi.attr("fill",function(a,n){return e==Te.EV_path?"#00000011":l(t.voronoi_means[n])}),ge.interComms.attr("fill",function(a,n){return e==Te.EV_path?"#00000011":l(t.interComm_means[n])}),ge.canvas.width=t.width,ge.canvas.height=t.height,a.hide=!1,we.updateMap(),ge.currentLayerPath=e,n.attr("xlink:href",t.url),d3.select(ge.legend_element).style("display","none"),e!=Te.EV_path&&(d3.select(ge.legend_element).style("display","block"),$e.fillScale(ge.color_legend_canvas,ge.color_legend_svg,l,Te.layers[e].min_value,Te.layers[e].max_value))})}function He(e){ge.imgs_EV.attr("xlink:href",ge.cachedLayers[Te.EV_path].url)}var Ye={loadLayer:Be,setLayer:Ae,setEVLayer:He},Xe=a("7dc5");function Ge(e){function t(t,a){return ge.firstVoronoiByInterComm[e]<=a&&(e==ge.interComm_shape.features.length-1||ge.firstVoronoiByInterComm[e+1]>a)?1:0}return t}function Ne(e,t,a){return e.append("g").selectAll("path").data(ge.voronoi_shape.features).enter().append("path").attr("d",ge.pathGenerator).attr("vector-effect","non-scaling-stroke").style("stroke","#666").style("fill-opacity",t).style("stroke-opacity",t).on("mouseover",function(e,a){d3.select(this).style("fill-opacity",t),ge.defs_path.datum(e.geometry),we.update_clip(),we.update_chart(a,ge.currentLayerPath,!0,ge.onHistChange),we.update_text_school(a,ge.currentLayerPath,!0,ge.onSchools)}).on("mouseout",function(e,t){-1!=ge.highlightedInterComm&&(d3.select(this).style("fill-opacity",Ge(ge.highlightedInterComm)(e,t)),d3.select(this).style("stroke-opacity",Ge(ge.highlightedInterComm)(e,t))),ge.defs_path.datum([]),we.update_clip(),ge.svg_EV.attr("style","display:none;"),ge.svg_circle_EV.attr("style","display:none;")}).on("dblclick",function(e,n){ge.interComms.style("pointer-events","all"),ge.map.fitBounds(ge.initialBounds),ge.highlightedInterComm=-1,ge.interComms.style("fill-opacity",a),ge.voronoi.style("fill-opacity",t),ge.voronoi.style("stroke-opacity",t),ge.defs_path.datum([]),we.update_clip(),ge.svg_EV.attr("style","display:none;"),ge.svg_circle_EV.attr("style","display:none;")}).on("mousemove",function(){d3.event&&d3.event.clientX&&d3.event.clientY&&ge.currentLayerPath!=Xe.EV_path?we.update_EV_preview(d3.event.clientX,d3.event.clientY):(ge.svg_EV.attr("style","display:none;"),ge.svg_circle_EV.attr("style","display:none;"))}).on("mousedown",function(){d3.event&&d3.event.clientX&&d3.event.clientY&&ge.currentLayerPath!=Xe.EV_path&&(ge.lastMouseDownX=d3.event.clientX,ge.lastMouseDownY=d3.event.clientY)})}function Re(e,t,a,n){return e.append("g").selectAll("path").data(ge.interComm_shape.features).enter().append("path").attr("d",ge.path).attr("vector-effect","non-scaling-stroke").style("stroke","#333").attr("fill","#fff").attr("fill-opacity",n).style("pointer-events","all").on("mouseover",function(e,r){-1!=ge.highlightedInterComm?r!=ge.highlightedInterComm?d3.select(this).style("fill-opacity",n):d3.select(this).style("fill-opacity",t):d3.select(this).style("fill-opacity",a),we.update_chart(r,ge.currentLayerPath,!0),we.update_text_school(r,ge.currentLayerPath,!1)}).on("mouseout",function(e,r){-1!=ge.highlightedInterComm?r==ge.highlightedInterComm?d3.select(this).style("fill-opacity",t):d3.select(this).style("fill-opacity",a):d3.select(this).style("fill-opacity",n),ge.svg_EV.attr("style","display:none;"),ge.svg_circle_EV.attr("style","display:none;")}).on("click",function(e,n){if(!(!d3.event||!d3.event.clientX||!d3.event.clientY||Math.abs(d3.event.clientX-ge.lastMouseDownX)>=5||Math.abs(d3.event.clientY-ge.lastMouseDownY)>=5)){ge.interComms.style("pointer-events","all"),d3.select(this).style("pointer-events","none"),ge.interComms.style("fill-opacity",a),d3.select(this).style("fill-opacity",t),ge.highlightedInterComm=n,ge.voronoi.style("fill-opacity",Ge(n)),ge.voronoi.style("stroke-opacity",Ge(n));var r=d3.select(this).node().getBBox(),o=ge.map.layerPointToLatLng(L.point(r.x,r.y)),s=ge.map.layerPointToLatLng(L.point(r.x+r.width,r.y+r.height));ge.map.fitBounds(L.latLngBounds(o,s)),ge.svg_EV.attr("style","display:none;"),ge.svg_circle_EV.attr("style","display:none;")}}).on("mousemove",function(){d3.event&&d3.event.clientX&&d3.event.clientY&&ge.currentLayerPath!=Xe.EV_path?we.update_EV_preview(d3.event.clientX,d3.event.clientY):(ge.svg_EV.attr("style","display:none;"),ge.svg_circle_EV.attr("style","display:none;"))}).on("mousedown",function(){d3.event&&d3.event.clientX&&d3.event.clientY&&(ge.lastMouseDownX=d3.event.clientX,ge.lastMouseDownY=d3.event.clientY)})}var Ue={defineVoronoi:Ne,defineInterComms:Re},Ze=function(e,t,a,n,r,o,i,l,c){ge.interComm_shape=o,ge.voronoi_shape=i,ge.onHistChange=l,ge.onSchools=c,ge.legend_element=n;var u=new L.LatLng(s.viewport.topLatitude,s.viewport.leftLongitude),d=new L.LatLng(s.viewport.bottomLatitude,s.viewport.rightLongitude);function p(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){$e.setLocation(e.coords.latitude,e.coords.longitude)})}ge.initialBounds=L.latLngBounds(u,d),d3.select(n).style("display","none"),ge.color_legend_canvas=d3.select(n).append("canvas"),ge.color_legend_svg=d3.select(n).append("svg"),ge.color_legend_svg.append("g"),p(),$e.createMap(e),L.geoJson(o,{style:$e.blankStyle}).addTo(ge.map);var h=d3.select(e).select(".leaflet-zoom-animated");function m(e,t){var a=ge.map.latLngToLayerPoint(new L.LatLng(t,e));this.stream.point(a.x,a.y)}var f=d3.geo.transform({point:m});ge.pathGenerator=d3.geo.path().projection(f);var v=h.append("defs");ge.defs_path=v.append("path").attr("id","clip_path"),v.append("clipPath").attr("id","clip").append("use").attr("xlink:href","#clip_path"),ge.imgs=h.selectAll("image").data([0]).enter().append("svg:image").attr("x",0).attr("y",0).attr("xlink:href","").attr("clip-path","").attr("preserveAspectRatio","none").style("object-fit","cover"),we.update_clip();var g=0,_=.4,y=1;ge.svg_EV=d3.select(t).attr("style","display:none;"),ge.svg_circle_EV=d3.select(a).attr("style","display:none;"),ge.imgs_EV=ge.svg_EV.selectAll("image").data([0]).enter().append("svg:image").attr("x",0).attr("y",0).attr("xlink:href","").attr("preserveAspectRatio","none").style("object-fit","cover");var b=ge.svg_EV.append("g");b.selectAll("path").data([o.features[0]]).enter().append("path").attr("vector-effect","non-scaling-stroke").style("stroke","#000").style("fill-opacity",0).style("stroke-opacity",1),ge.voronoi=Ue.defineVoronoi(h,g,y),ge.interComms=Ue.defineInterComms(h,g,_,y),ge.markerIcon={iconUrl:"assets/marker.png",iconSize:[24,24],iconAnchor:[12,24]},ge.markerElement=h.append("g").selectAll("image").data([0]).enter().append("svg:image").attr("xlink:href",ge.markerIcon.iconUrl).attr("width",ge.markerIcon.iconSize[0]).attr("height",ge.markerIcon.iconSize[1]).attr("visibility","hidden").style("pointer-events","none"),ge.canvas=document.createElement("canvas"),ge.update_parameters={hide:!0},ge.map.on("viewreset",function(){we.updateMap()});var C=ge.map.zoomOut.bind(ge.map),E=ge.map.zoomIn.bind(ge.map);return[Ye.loadLayer,Ye.setLayer,$e.setLocation,Ye.setEVLayer,C,E]},Je={props:["layers","currentLayerPath","currentLocation","currentZoom","isFuture"],data:function(){return{loadLayer:function(){},setLayer:function(){},setLocation:function(){},setEVLayer:function(){},zoomMinus:function(){},zoomPlus:function(){}}},computed:{isEspacesVerts:function(){return this.currentLayerPath==s.EV_path},currentUnit:function(){if(this.currentLayerPath)return s.layers[this.currentLayerPath].unit},forestColor:function(){return s.layers[s.EV_path].colors[0]},waterColor:function(){return s.layers[s.EV_path].colors[1]},greenColor:function(){return s.layers[s.EV_path].colors[2]},currentYear:function(){return(new Date).getFullYear()},hasFutureAvailable:function(){return!!s.layers[this.currentLayerPath].future}},mounted:function(){var e=this,t="data/intercommunalites.geojson",a="data/voronois.json";queue().defer(d3.json,t).defer(d3.json,a).await(function(t,a,n){var r=Ze(e.$refs.map,e.$refs.svg,e.$refs.circle_svg,e.$refs.legend,t,a,n,function(t,a){return e.$emit("newHistogram",t,a)},function(t){return e.$emit("newSchools",t)}),o=Object(A["a"])(r,6);e.loadLayer=o[0],e.setLayer=o[1],e.setLocation=o[2],e.setEVLayer=o[3],e.zoomMinus=o[4],e.zoomPlus=o[5],Object.keys(s.layers).forEach(function(t){e.layers[t].path=t,e.loadLayer(t,!1,function(){e.layers[t].loaded=!0,t==s.EV_path&&e.setEVLayer(t)}),s.layers[t].future&&(console.log("Preloading future layer:",s.layers[t].future),e.loadLayer(t,!0,function(){}))}),e.setLayer(e.currentLayerPath)})},watch:{currentLayerPath:function(){this.setLayer(this.currentLayerPath,this.hasFutureAvailable&&this.isFuture)},isFuture:function(){this.setLayer(this.currentLayerPath,this.hasFutureAvailable&&this.isFuture)},currentLocation:function(e){var t=Object(A["a"])(e,2),a=t[0],n=t[1];this.setLocation(a,n)},currentZoom:function(e,t){e<t?this.zoomMinus():this.zoomPlus()}}},Ke=Je,We=(a("894b"),Object(d["a"])(Ke,T,B,!1,null,null,null));We.options.__file="Map.vue";var Qe=We.exports,et=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"sidebar"},[e.currentLayerPath&&e.layers[e.currentLayerPath].loaded&&!e.isEspacesVerts?a("div",[a("h2",[e._v(e._s(e.layers[e.currentLayerPath].title))]),a("div",{domProps:{innerHTML:e._s(e.layers[e.currentLayerPath].content)}}),e.isEspacesVerts?e._e():a("Histogram",{attrs:{x:e.currentHistogramX,y:e.currentHistogramY}}),e.schoolCount?a("p",[e._v("Il y a "+e._s(e.schoolCount)+" établissements scolaires dans la région sélectionnée.")]):e._e()],1):a("div",{staticClass:"split"},[e._m(0),e._m(1)])])},tt=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("article",[a("h2",[e._v("Bienvenue sur EcoParis.")]),a("p",[e._v("EcoParis est une visualisation interactive des données cartographiques des services écosystémiques en territoires urbains et péri-urbains en région Ile-de-France issues du projet "),a("a",{attrs:{href:"https://idefese.wordpress.com/"}},[e._v("IDEFESE")]),e._v(".")]),a("p",[e._v("Pour commencer, vous pouvez sélectionner une couche à afficher parmi des mesures de rétention "),a("a",{attrs:{href:"#"}},[e._v("de phosphore")]),e._v(" et "),a("a",{attrs:{href:"#"}},[e._v("d'azote")]),e._v(", des mesures de "),a("a",{attrs:{href:"#"}},[e._v("réduction de la température")]),e._v(" due à la végétation ou encore de "),a("a",{attrs:{href:"#"}},[e._v("valeur économique")]),e._v(" des régions.")]),a("p",[e._v("Vous pouvez aussi choisir d'afficher l'évolution estimée de ces mesures à l'horizon 2025 dans un scénario de changement climatique.")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("article",{staticClass:"about"},[a("p",[e._v("EcoParis a été conçu par des élèves du cours de "),a("a",{attrs:{href:"https://edu.epfl.ch/coursebook/en/data-visualization-COM-480"}},[e._v("Data Visualization")]),e._v(" de l'EPFL, avec l'aide de Perrine Hamel du projet "),a("a",{attrs:{href:"https://naturalcapitalproject.stanford.edu/"}},[e._v("Natural Capital Project")]),e._v(" de Stanford.")]),a("section",{staticClass:"slideshow"},[a("a",{attrs:{href:"https://www.epfl.ch/"}},[a("img",{attrs:{src:"assets/epfl.png",alt:"Logo EPFL"}})]),a("a",{attrs:{href:"https://naturalcapitalproject.stanford.edu/"}},[a("img",{attrs:{src:"assets/natcap.jpg",alt:"Logo NatCap"}})])])])}],at=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{ref:"graph",staticClass:"graph-box"})},nt=[],rt=function(e){Plotly.react(e.$refs.graph,[{x:e.x,y:e.y,type:"histogram",histfunc:"sum",xbins:{end:256,size:1,start:0}}],{margin:{l:35,r:35,t:5,b:20}},{displayModeBar:!1})},ot={props:["x","y"],mounted:function(){rt(this)},watch:{x:function(){rt(this)}}},st=ot,it=(a("cd26"),Object(d["a"])(st,at,nt,!1,null,null,null));it.options.__file="Histogram.vue";var lt=it.exports,ct={props:["layers","currentLayerPath","currentHistogramX","currentHistogramY","schoolCount"],components:{Histogram:lt},computed:{isEspacesVerts:function(){return this.currentLayerPath==s.EV_path}}},ut=ct,dt=(a("f203"),Object(d["a"])(ut,et,tt,!1,null,null,null));dt.options.__file="Sidebar.vue";var pt=dt.exports,ht=s.EV_path,mt={components:{Intro:h,About:y,ZoomControl:P,LocationControl:M,Layers:$,Map:Qe,Sidebar:pt},data:function(){return{layers:Object.keys(s.layers).reduce(function(e,t){return e[t]=s.layers[t],e[t].loaded=!1,e[t].path=t,e},{}),isFuture:!1,currentLayerPath:ht,currentZoom:0,currentLocation:null,currentHistogramX:null,currentHistogramY:null,introVisible:!0,sidebarVisible:!1,aboutVisible:!1,schoolCount:null}},computed:{currentLayerLoaded:function(){return this.layers[this.currentLayerPath].loaded}}},ft=mt,vt=(a("5c0b"),Object(d["a"])(ft,r,o,!1,null,null,null));vt.options.__file="App.vue";var gt=vt.exports;n["a"].config.productionTip=!1,new n["a"]({render:function(e){return e(gt)}}).$mount("#app")},"58be":function(e,t,a){},"5c0b":function(e,t,a){"use strict";var n=a("5e27"),r=a.n(n);r.a},"5e27":function(e,t,a){},"7dc5":function(e){e.exports={layers:{"data/rasters/espaces_verts.json":{name:"Esp. verts",icon:"E",colorScheme:0,useColorScheme:!1,colors:["#ceae7f","#89c4f4","#c8f7c5"],min_value:0,max_value:0,title:"",content:"",unit:""},"data/rasters/pollination_ref.json":{name:"Polli.",icon:"P",colorScheme:0,useColorScheme:!0,min_value:0,max_value:.123434,title:"Mesure de la pollinisation.",content:"<p>Pour de nombreuses plantes à fleurs, la réalisation du cycle sexuel implique l’intervention d’animaux pollinisateurs, qui permettent la rencontre des gamètes par leur comportement de prise alimentaire. L’abondance de pollinisateurs est donc un facteur déterminant du rendement agricole et ce pour 75% des cultures humaines.</p><p style='text-align: center;'><a class='button' href='https://bees.techno-science.ca/francais/les-abeilles/la-pollinisation/default.php' target='_blank'>En savoir plus</a></p>",unit:"en pourcent",future:"data/rasters/pollination_cc.json"},"data/rasters/T_reduction.json":{name:"Temp.",icon:"T",colorScheme:1,useColorScheme:!0,min_value:.210985,max_value:2.45584,title:"Mesure du service de rafraîchissement.",content:"<p>Le service de rafraichissement peut atteindre plusieurs degrés. Il réduit les risques sanitaires (maladies cardio-vasculaires et décès directement liés aux canicules) et potentiellement la consommation énergétique associée à la climatisation.</p>",unit:"en °C"},"data/rasters/L_ref.json":{name:"Nappe",icon:"Na",colorScheme:2,useColorScheme:!0,min_value:0,max_value:771.576,title:"Mesure du rechargement des nappes.",content:"<p>Cette mesure permet de quantifier la rétention des eaux de pluie par les écosystèmes en amont des cours d’eau. Elle établit, pour chaque pixel, un bilan hydrique mensuel permettant de calculer la quantité d’eau pluviale s’infiltrant vers les nappes phréatiques, nette du ruissellement et de l’évapotranspiration. La majorité des captages pour la production d’eaux destinées à la consommation humaine exploitent des eaux souterraines. Avec les effets du changement climatique, des aléas météorologiques plus marqués et plus fréquents, sécheresses ou épisodes pluvieux intenses, vont impacter les ressources en eau.</p><p style='text-align: center;'><a class='button' href='http://www.mauldre.fr/les-actions/reconquerir-la-qualite-de-l-eau/164-proteger-les-nappes-phreatiques' target='_blank'>En savoir plus</a></p>",unit:"en mm/an",future:"data/rasters/L_cc.json"},"data/rasters/n_ret_ref.json":{name:"Nutri.",icon:"Nu",colorScheme:3,useColorScheme:!0,min_value:.487002,max_value:1,title:"Mesure de la rétention des nutriments.",content:"<p>La mesure vise à estimer les quantités d’azote et de phosphore retenues annuellement en amont du réseau hydrographique après un dépôt diffus. Le service de rétention permet d'améliorer la qualité de l'eau (superficielle et souterraine). Il est directement utile aux organismes de gestion de l'eau (syndicats et département d'assainissement), et donc aux habitants dont les impôts financent la maintenance des services d'assainissement.</p><p style='text-align: center;'p><a class='button' href='http://croppp.org/IMG/pdf/herpollu_cle8bc23e.pdf' target='_blank'>En savoir plus</a></p>",unit:"en pourcent",future:"data/rasters/n_ret_cc.json"},"data/rasters/correlation_ref.json":{name:"Corr.",icon:"C",colorScheme:4,useColorScheme:!0,min_value:0,max_value:100,title:"Hotspots des services.",content:"<p>Une mesure de corrélation a été calculée pour mettre en avant les hotspots naturels. La mesure consiste en la moyenne des quatre autres (rétention des nutriments, rechargement des nappes, rafraîchissement et pollinisation) normalisées par pixel. Plus il y a d'espaces naturels, plus la quantité de service augmente tout en dépendant des procédés biophysiques propres à chaque service.</p>",unit:""},"data/rasters/ecoles_elementaires.json":{name:"Ecoles elementaires",icon:"E",colorScheme:0,useColorScheme:!0,min_value:0,max_value:0,title:"Nombre d'écoles élémentaires et maternelles.",content:"<p>Should not appear anyway, find something to fill here.</p>",hidden:!0,unit:""}},viewport:{topLatitude:49.23719070644322,bottomLatitude:48.12054154281846,leftLongitude:1.44727950476602,rightLongitude:3.555686958558566},EV_path:"data/rasters/espaces_verts.json",Ecole_path:"data/rasters/ecoles_elementaires.json",Urban_cooling:"data/rasters/T_reduction.json","":"4 - red"}},"894b":function(e,t,a){"use strict";var n=a("a130"),r=a.n(n);r.a},"91fa":function(e,t,a){"use strict";var n=a("a90f"),r=a.n(n);r.a},a130:function(e,t,a){},a90f:function(e,t,a){},bed8:function(e,t,a){"use strict";var n=a("2a3c"),r=a.n(n);r.a},cd26:function(e,t,a){"use strict";var n=a("58be"),r=a.n(n);r.a},d05b:function(e,t,a){},f203:function(e,t,a){"use strict";var n=a("0466"),r=a.n(n);r.a},f27d:function(e,t,a){"use strict";var n=a("0f8a"),r=a.n(n);r.a},fcd1:function(e,t,a){}});
//# sourceMappingURL=app.0790053a.js.map