(function(e){function t(t){for(var r,s,i=t[0],l=t[1],c=t[2],d=0,p=[];d<i.length;d++)s=i[d],n[s]&&p.push(n[s][0]),n[s]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);u&&u(t);while(p.length)p.shift()();return o.push.apply(o,c||[]),a()}function a(){for(var e,t=0;t<o.length;t++){for(var a=o[t],r=!0,i=1;i<a.length;i++){var l=a[i];0!==n[l]&&(r=!1)}r&&(o.splice(t--,1),e=s(s.s=a[0]))}return e}var r={},n={app:0},o=[];function s(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=e,s.c=r,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(a,r,function(t){return e[t]}.bind(null,r));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],l=i.push.bind(i);i.push=t,i=i.slice();for(var c=0;c<i.length;c++)t(i[c]);var u=l;o.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"0466":function(e,t,a){},"054f":function(e,t,a){"use strict";var r=a("fcd1"),n=a.n(r);n.a},"0f8a":function(e,t,a){},"2a3c":function(e,t,a){},3664:function(e,t,a){},"50c4":function(e,t,a){"use strict";var r=a("d05b"),n=a.n(r);n.a},"56d7":function(e,t,a){"use strict";a.r(t);a("cadf"),a("551c"),a("097d");var r=a("2b0e"),n=a("a925"),o=function(){var e=this,t=this,a=t.$createElement,r=t._self._c||a;return r("div",{class:["tutorial-"+t.currentTutorialStep],attrs:{id:"app"}},[r("transition",{attrs:{name:"fade"}},[t.introVisible?r("Intro",{attrs:{isLoading:!t.currentLayerLoaded},on:{dismiss:function(){return t.introVisible=!1}}}):t._e()],1),t.aboutVisible?r("About",{on:{dismiss:function(){return t.aboutVisible=!1}}}):t._e(),r("section",{staticClass:"horizontal-split"},[r("Tutorial",{attrs:{currentLayerPath:t.currentLayerPath},on:{layerChange:function(t){return e.currentLayerPath=t}},model:{value:t.currentTutorialStep,callback:function(e){t.currentTutorialStep=e},expression:"currentTutorialStep"}}),r("section",{staticClass:"vertical-split"},[r("section",{staticClass:"menu"},[r("LocationControl",{attrs:{onLocation:function(t){return e.currentLocation=t}}}),r("Layers",{attrs:{layers:t.layers},model:{value:t.currentLayerPath,callback:function(e){t.currentLayerPath=e},expression:"currentLayerPath"}}),r("ZoomControl",{on:{zoomOut:function(){return t.currentZoom-=1},zoomIn:function(){return t.currentZoom+=1}}}),r("a",{staticClass:"about-button",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),function(){return t.aboutVisible=!0}()}}},[t._v(t._s(t.$t("titles.credits")))])],1),r("Map",{attrs:{layers:t.layers,currentLayerPath:t.currentLayerPath,currentLocation:t.currentLocation,currentZoom:t.currentZoom,isFuture:t.isFuture},on:{toggleFuture:function(){return t.isFuture^=!0},newHistogram:function(t,a){e.currentHistogramX=t,e.currentHistogramY=a},newSchools:function(t){return e.schoolCount=t},newName:function(t){return e.interCommName=t}}}),r("Sidebar",{attrs:{layers:t.layers,currentLayerPath:t.currentLayerPath,currentHistogramX:t.currentHistogramX,currentHistogramY:t.currentHistogramY,schoolCount:t.schoolCount,interCommName:t.interCommName}})],1)],1)],1)},s=[],i=(a("ac6a"),a("456d"),a("7dc5")),l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"intro"},[e._m(0),a("p",[e._v("Découvrez l'influence de la nature sur votre vie à Paris.")]),a("section",{staticClass:"buttons"},[e.isLoading?a("a",{staticClass:"button loading"},[e._v("Chargement")]):[a("a",{staticClass:"button",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.startFrench(t)}}},[a("i",{staticClass:"flag-icon flag-icon-fr"}),e._v(" Commencer la visite")]),a("a",{staticClass:"button",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.startEnglish(t)}}},[a("i",{staticClass:"flag-icon flag-icon-us"}),e._v(" Get started")])]],2)])},c=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("h1",[e._v("\n    EcoParis\n    "),a("img",{attrs:{src:"assets/parrot.svg"}})])}],u={props:["isLoading"],methods:{startFrench:function(){this.$i18n.locale="fr",this.$emit("dismiss")},startEnglish:function(){this.$i18n.locale="en",this.$emit("dismiss")}}},d=u,p=(a("91fa"),a("2877")),h=Object(p["a"])(d,l,c,!1,null,null,null);h.options.__file="Intro.vue";var m=h.exports,f=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"tutorial"},[a("p",{domProps:{innerHTML:e._s(e.currentStepHtml)}}),a("a",{staticClass:"button dark",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.close(t)}}},[a("span",{staticClass:"keycap"},[e._v("ESC")]),e._v(" "+e._s(e.$t("skip")))]),e.value<12?a("a",{staticClass:"button dark full",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.next(t)}}},[a("span",{staticClass:"keycap"},[e._v("→")]),e._v(" "+e._s(e.$t("next")))]):e._e()])},g=[];function v(e){e&&37==(e.which||e.keyCode)?this.prev():e&&39==(e.which||e.keyCode)?this.next():e&&27==(e.which||e.keyCode)&&this.close()}var y={props:["value","currentLayerPath"],mounted:function(){document.body.addEventListener("keyup",v.bind(this))},beforeDestroy:function(){document.body.removeEventListener("keypress",v.bind(this))},methods:{prev:function(){this.value>1&&this.$emit("input",this.value-1)},next:function(){5==this.value?this.$emit("layerChange","data/rasters/L_ref.json"):11==this.value?this.$emit("layerChange","data/rasters/correlation_ref.json"):12==this.value?this.close():this.$emit("input",this.value+1)},close:function(){this.$emit("input",null)}},computed:{currentStepHtml:function(){return this.$t("tutorial.".concat(this.value||12))}},watch:{currentLayerPath:function(e){5==this.value&&"data/rasters/L_ref.json"==e?this.$emit("input",6):11==this.value&&"data/rasters/correlation_ref.json"==e&&this.$emit("input",12)}}},_=y,b=(a("f358"),Object(p["a"])(_,f,g,!1,null,null,null));b.options.__file="Tutorial.vue";var C=b.exports,w=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"about-wrapper"},[a("a",{staticClass:"about-close",attrs:{href:"#"},on:{click:function(t){t.preventDefault(),e.$emit("dismiss")}}},[e._v("X")]),a("section",{staticClass:"about-box"},[a("h2",[e._v(e._s(e.$t("credits.title")))]),a("p",{domProps:{innerHTML:e._s(e.$t("credits.what"))}}),a("ul",[a("li",[e._v(e._s(e.$t("credits.alex")))]),a("li",[e._v(e._s(e.$t("credits.karthi")))]),a("li",[e._v(e._s(e.$t("credits.romain")))])]),a("p",{domProps:{innerHTML:e._s(e.$t("credits.collaborators"))}}),a("p",{domProps:{innerHTML:e._s(e.$t("credits.credits-1"))}}),a("p",{domProps:{innerHTML:e._s(e.$t("credits.credits-2"))}}),a("p",{domProps:{innerHTML:e._s(e.$t("credits.thanks"))}}),a("p",{domProps:{innerHTML:e._s(e.$t("credits.logo"))}})])])},P=[],x={},E=x,k=(a("50c4"),Object(p["a"])(E,w,P,!1,null,null,null));k.options.__file="About.vue";var V=k.exports,S=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"zoom-control"},[a("a",{staticClass:"minus",on:{click:function(t){t.preventDefault(),e.$emit("zoomOut")}}},[e._v("-")]),a("a",{staticClass:"plus",on:{click:function(t){t.preventDefault(),e.$emit("zoomIn")}}},[e._v("+")])])},I=[],j={},T=j,F=(a("f27d"),Object(p["a"])(T,S,I,!1,null,null,null));F.options.__file="ZoomControl.vue";var M=F.exports,$=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"location-control"},[a("a",{staticClass:"locate",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.locate(t)}}},[a("i",{staticClass:"fas fa-map-marker-alt"})]),a("div",{class:{search:!0,active:e.searchExpanded}},[a("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.toggleSearch(t)}}},[e.searchExpanded?a("i",{staticClass:"fas fa-search-minus"}):a("i",{staticClass:"fas fa-search-location"})]),a("input",{ref:"searchInput",staticClass:"autocomplete",attrs:{type:"text"},on:{keyup:function(t){if(!("button"in t)&&27!==t.keyCode)return null;e.searchExpanded=!1}}})])])},N=[],q={props:["onLocation"],data:function(){return{searchExpanded:!1}},mounted:function(){var e=this,t=new google.maps.places.Autocomplete(this.$refs.searchInput);t.setFields(["geometry"]),t.setOptions({strictBounds:!0}),t.setBounds({north:i.viewport.topLatitude,south:i.viewport.bottomLatitude,west:i.viewport.leftLongitude,east:i.viewport.rightLongitude}),t.addListener("place_changed",function(){var a=t.getPlace();a.geometry?(e.searchExpanded=!1,e.onLocation([a.geometry.location.lat(),a.geometry.location.lng()])):e.onLocation(null,null)})},methods:{locate:function(){var e=this;navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){t&&e.onLocation([t.coords.latitude,t.coords.longitude])})},toggleSearch:function(){this.searchExpanded^=!0,this.$refs.searchInput.focus()}}},H=q,D=(a("bed8"),Object(p["a"])(H,$,N,!1,null,null,null));D.options.__file="LocationControl.vue";var O=D.exports,A=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"layers"},[a("h3",[e._v(e._s(e.$t("titles.layers")))]),a("div",{staticClass:"buttons"},e._l(e.layers,function(t,r){return t.hidden?e._e():a("a",{key:r,class:{active:e.value==t.path},style:{background:e.value==t.path?t.active_color:t.color},attrs:{title:r},on:{click:function(a){a.preventDefault(),e.select(t)}}},[a("span",{staticClass:"icon",domProps:{innerHTML:e._s(e.$t("layers."+t.id+".icon"))}}),a("span",[e._v(e._s(e.$t("layers."+t.id+".name")))]),t.loaded?e._e():a("div",{staticClass:"loader-tile-grid"},[a("div",{staticClass:"loader-tile loader-tile1"}),a("div",{staticClass:"loader-tile loader-tile2"}),a("div",{staticClass:"loader-tile loader-tile3"}),a("div",{staticClass:"loader-tile loader-tile4"}),a("div",{staticClass:"loader-tile loader-tile5"}),a("div",{staticClass:"loader-tile loader-tile6"}),a("div",{staticClass:"loader-tile loader-tile7"}),a("div",{staticClass:"loader-tile loader-tile8"}),a("div",{staticClass:"loader-tile loader-tile9"})])])}))])},B=[],Y={props:["layers","value"],methods:{select:function(e){e.loading||this.$emit("input",e.path)}}},R=Y,G=(a("054f"),Object(p["a"])(R,A,B,!1,null,null,null));G.options.__file="Layers.vue";var X,U=G.exports,Z=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"map-container"},[a("section",{ref:"map",staticClass:"map"}),a("svg",{ref:"circle_svg",staticClass:"EV-circle-svg"}),a("svg",{ref:"svg",staticClass:"EV-svg"}),e.hasFutureAvailable&&!e.isFuture?a("section",{staticClass:"year"},[a("p",[e._v("2012")]),a("a",{style:{color:e.futureColor},attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),function(){return e.$emit("toggleFuture")}()}}},[a("i",{staticClass:"fas fa-fast-forward"})])]):e.hasFutureAvailable?a("section",{staticClass:"year"},[a("p",[e._v("2030")]),a("a",{style:{color:e.presentColor},attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),function(){return e.$emit("toggleFuture")}()}}},[a("i",{staticClass:"fas fa-fast-backward"})])]):e._e(),a("section",{staticClass:"legend"},[a("div",{ref:"legend",staticClass:"legend-inner"}),e.isEspacesVerts?a("section",[a("h3",[e._v(e._s(e.$t("legend.natural-spaces")))]),a("figure",[a("div",{staticClass:"item",style:{backgroundColor:e.forestColor}}),a("figcaption",{domProps:{innerHTML:e._s(e.$t("legend.wood"))}})]),a("figure",[a("div",{staticClass:"item",style:{backgroundColor:e.waterColor}}),a("figcaption",{domProps:{innerHTML:e._s(e.$t("legend.water"))}})]),a("figure",[a("div",{staticClass:"item",style:{backgroundColor:e.greenColor}}),a("figcaption",{domProps:{innerHTML:e._s(e.$t("legend.leisure"))}})])]):e.currentUnit?a("section",[a("p",[e._v("("+e._s(e.currentUnit)+")")])]):e._e()])])},W=[],J=a("3835"),K=a("ade3"),Q={},ee="",te=null,ae=null,re=null,ne=null,oe=null,se=null,ie=null,le=null,ce=null,ue=null,de={},pe=null,he=null,me=null,fe=null,ge=[],ve=null,ye=null,_e=null,be=null,Le=null,Ce=null,we=null,Pe=null,xe=-1,Ee=null,ke={},Ve=0,Se=0,Ie=null,je=null,Te=!0,Fe=!1,Me={x:0,y:0},$e=!1,Ne=-1,ze=!1,qe=(X={cachedLayers:Q,currentLayerPath:ee,map:te,mapElement:ae,currentGeoLat:re,currentGeoLng:ne,svg_EV:oe,svg_circle_EV:se,interComms:ie,voronoi:le,imgs:ce,imgs_EV:ue,update_parameters:de,markerElement:pe,canvas:he,voronoi_shape:me,interComm_shape:fe,firstVoronoiByInterComm:ge,pathGenerator:ve,defs_path:ye,legend_element:_e,color_legend_canvas:be,color_legend_svg:Le,onSchools:Ce,onHistChange:we,onNewName:Pe,highlightedInterComm:xe,initialBounds:Ee,markerIcon:ke,lastMouseDownX:Ve,lastMouseDownY:Se,voronoiContainment:Ie,interCommContainment:je,showCirclePreview:Te,showFutureInsteadOfEV:Fe,lastMousePosition:Me,isFuture:$e},Object(K["a"])(X,"currentLayerPath",ee),Object(K["a"])(X,"currentChartIndex",Ne),Object(K["a"])(X,"currentChartIndexIsVoronoi",ze),X),He=a("7dc5");function De(){var e=qe.map,t=qe.cachedLayers,a=qe.currentLayerPath,r=qe.defs_path;function n(r,n){if(t[a]){var o=e.latLngToLayerPoint([t[a].tl_lat,t[a].tl_lng]),s=e.latLngToLayerPoint([t[a].br_lat,t[a].br_lng]),i=s.x-o.x,l=s.y-o.y,c=e.latLngToLayerPoint(L.latLng(n,r)),u=(c.x-o.x)/(s.x-o.x)*(i-1),d=(c.y-o.y)/(s.y-o.y)*(l-1);this.stream.point(u,d)}}var o=d3.geo.transform({point:n}),s=d3.geo.path().projection(o);r.attr("d",s)}function Oe(e,t){Ge();var a=qe.svg_EV,r=qe.svg_circle_EV,n=qe.map,o=qe.cachedLayers,s=qe.imgs_EV,i=qe.currentCircleLayerPath;if(!o[i]||!qe.showCirclePreview)return qe.svg_EV.style("display","none"),void qe.svg_circle_EV.style("display","none");var l=parseInt(a.style("width").substr(0,a.style("width").length-2)),c=parseInt(a.style("height").substr(0,a.style("width").length-2)),u=parseInt(r.style("width").substr(0,r.style("width").length-2)),d=parseInt(r.style("height").substr(0,r.style("width").length-2));a.style("top",t-c-15+"px"),a.style("left",e+15+"px"),a.style("display",""),r.style("top",t-d/2+"px"),r.style("left",e-u/2+"px"),r.style("display","");var p=l/u,h=L.latLng(o[i].tl_lat,o[i].tl_lng),m=L.latLng(o[i].br_lat,o[i].br_lng),f=n.latLngToContainerPoint(h),g=(n.latLngToContainerPoint(m),e-f.x),v=t-f.y,y=L.point(e-g*p,t-v*p),_=(n.latLngToLayerPoint(m).x-n.latLngToLayerPoint(h).x)*p,b=(n.latLngToLayerPoint(m).y-n.latLngToLayerPoint(h).y)*p;s.attr("width",_),s.attr("height",b),s.attr("transform","translate("+(+y.x-e+l/2)+","+(+y.y-t+c/2)+")")}function Ae(e){var t=qe.currentChartIndex,a=qe.currentChartIndexIsVoronoi,r=qe.cachedLayers,n=r[e];if(qe.isFuture&&He.layers[e].future&&(n=r[He.layers[e].future]),n){var o=[];o=t<0?n.entire_hist:1==a?n.voronoi_hist[t]:n.interComm_hist[t],e!=He.Urban_cooling&&(o[0]=0),qe.onHistChange(lt.range(256),o)}}function Be(e){var t=qe.currentChartIndex,a=qe.currentChartIndexIsVoronoi,r=qe.cachedLayers;if(e==He.Urban_cooling){var n=r[He.Ecole_path];if(!n)return;var o=[];o=t<0?n.entire_hist.slice(-1).pop():1==a?n.voronoi_hist[t].slice(-1).pop():n.interComm_hist[t].slice(-1).pop(),qe.onSchools(o)}else qe.onSchools(null)}function Ye(){var e=qe.map,t=qe.currentGeoLat,a=qe.currentGeoLng,r=qe.markerElement;if(t&&a){var n=e.latLngToLayerPoint([t,a]),o=n.x-qe.markerIcon.iconAnchor[0],s=n.y-qe.markerIcon.iconAnchor[1];r.attr("visibility","visible"),r.attr("transform","translate(".concat(o,", ").concat(s,")"))}else r.attr("visibility","hidden")}function Re(){var e=qe.map,t=(qe.cachedLayers,qe.voronoi),a=qe.interComms,r=qe.imgs,n=qe.imgs_EV,o=qe.update_parameters,s=qe.pathGenerator;if(o.hide)return console.log("hidden!"),a.attr("visibility","hidden"),t.attr("visibility","hidden"),r.attr("visibility","hidden"),void n.attr("visibility","hidden");a.attr("visibility","visible"),t.attr("visibility","visible"),r.attr("visibility","visible"),n.attr("visibility","visible");var i=o.tl,l=o.br;console.log("UPDATING");var c=e.latLngToLayerPoint(l).x-e.latLngToLayerPoint(i).x,u=e.latLngToLayerPoint(l).y-e.latLngToLayerPoint(i).y;r.attr("transform",function(t){var a=e.latLngToLayerPoint(i);return"translate("+a.x+","+a.y+")"}),r.attr("width",c),r.attr("height",u),a.attr("d",s),t.attr("d",s),De(),Ye(),qe.svg_EV.style("display","none"),qe.svg_circle_EV.style("display","none")}function Ge(){qe.showFutureInsteadOfEV&&He.layers[qe.currentLayerPath].future?qe.isFuture?(qe.currentCircleLayerPath=qe.currentLayerPath,qe.svg_circle_EV.style("border-color",He.color_present),qe.svg_EV.style("border-color",He.color_present)):(qe.currentCircleLayerPath=He.layers[qe.currentLayerPath].future,qe.svg_circle_EV.style("border-color",He.color_future),qe.svg_EV.style("border-color",He.color_future)):(qe.currentCircleLayerPath=He.EV_path,qe.svg_circle_EV.style("border-color",He.color_ev),qe.svg_EV.style("border-color",He.color_ev))}function Xe(){Ge();var e=qe.currentCircleLayerPath;qe.cachedLayers[e]&&qe.showCirclePreview&&qe.imgs_EV.attr("xlink:href",qe.cachedLayers[e].url)}var Ue={update_clip:De,update_EV_preview:Oe,update_chart:Ae,update_text_school:Be,updateMarker:Ye,updateMap:Re,updateCirclePreviewPath:Ge,updateCirclePreviewLayer:Xe},Ze={0:d3.interpolateOranges,1:d3.interpolateRdBu,2:d3.interpolateBlues,3:d3.interpolateGnBu,4:d3.interpolateRdYlGn};a("7dc5");function We(e){return fetch(e).then(function(e){return e.json()}).then(function(e){return e.data=JSON.parse(e.data),e})}var Je="https://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.png",Ke='&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>';function Qe(e){qe.map=L.map(e,{zoomControl:!1});var t=qe.map;t.fitBounds(qe.initialBounds),t.setMaxBounds(t.getBounds().pad(.025));var a=L.tileLayer(Je,{minZoom:9,maxZoom:14,attribution:Ke});a.addTo(t),t.setView(new L.LatLng(48.856614,2.3522219),t.getZoom()+2)}function et(e){return qe.interComm_shape.features.some(function(t){return d3.geoContains(t,e)})}function tt(e,t){z,e&&t&&et([t,e])?qe.map.setView(new L.LatLng(e,t),11):(e=null,t=null,qe.map.fitBounds(qe.initialBounds)),qe.currentGeoLat=e,qe.currentGeoLng=t,Ue.updateMarker()}function at(e){for(var t=Ze[e],a=[],r=0;r<256;++r)a.push(t(r/255));return a}function rt(e,t,a,r,n,o){for(var s=200,i=70,l={top:5,right:30,bottom:5,left:0},c=e.attr("height",s-l.top-l.bottom).attr("width",1).style("height",s-l.top-l.bottom+"px").style("width",i-l.left-l.right+"px").style("position","absolute").style("top",l.top+"px").style("left",l.left+"px").node(),u=c.getContext("2d"),d=function(e){return a((s-l.top-l.bottom-e)/(s-l.top-l.bottom)*255)},p=u.createImageData(1,s-l.top-l.bottom),h=0;h<s-l.top-l.bottom;++h){var m=d3.rgb(d(h)),f=4*h;o&&(f=4*(s-l.top-l.bottom-1)-4*h),p.data[f]=m.r,p.data[f+1]=m.g,p.data[f+2]=m.b,p.data[f+3]=255}u.putImageData(p,0,0);var g=[n,r];o&&(g=[r,n]);var v=d3.axisRight().scale(d3.scaleLinear().domain(g).range([1,s-l.bottom-l.top-1])).tickSize(6).ticks(8),y=t.attr("height","".concat(s,"px")).attr("width","".concat(i,"px")).style("position","absolute").style("left","0px").style("top","0px");y.select("g").attr("class","axis").attr("transform","translate(".concat(i-l.left-l.right,", ").concat(l.top-1,")")).call(v)}function nt(e,t){var a=e.slice();a.unshift(0),a.push(255);for(var r=a.length,n=t.length,o=[],s=0;s<n;++s)o[s]=s/(n-1);var i=d3.scale.linear().domain(o).range(t),l=[];for(s=0;s<r;++s){var c=s/(r-1);l.push(i(c))}return[a,l]}function ot(e){return{opacity:0,fillOpacity:0}}function st(e){for(var t=[],a=0;a<e;++a)t[a]=a;return t}function it(e){e&&120==(e.charCode||e.keyCode)&&(qe.showCirclePreview=!qe.showCirclePreview),e&&32==(e.charCode||e.keyCode)&&(qe.showFutureInsteadOfEV=!qe.showFutureInsteadOfEV),Ue.updateCirclePreviewLayer(),Ue.update_EV_preview(qe.lastMousePosition.x,qe.lastMousePosition.y)}var lt={loadContainmentFile:We,createMap:Qe,setLocation:tt,getColorsFromScheme:at,fillScale:rt,computeColorRange:nt,blankStyle:ot,range:st,handleKeyEvent:it},ct=a("7dc5");function ut(e,t,a){var r=qe.canvas,n=qe.voronoi_shape,o=qe.interComm_shape;if(qe.cachedLayers[e])a();else{var s=e;t&&(s=ct.layers[e].future),fetch(s).then(function(e){return e.json()}).then(function(t){console.log("Preloaded layer:",s),t.data=JSON.parse(t.data),t.percentiles=JSON.parse(t.percentiles);var i=t.data;r.width=t.width,r.height=t.height;var l=r.getContext("2d");l.createImageData(r.width,r.height);for(var c=r.height*r.width,u=1,d=0,p=c/u,h=r.height/u,m=[],f=[],g={},v=[],y=0;y<256;++y)v[y]=0;for(y=0;y<n.features.length;++y){f[y]=0,m[y]=0,g[y]=[];for(var _=0;_<256;++_)g[y][_]=0}var b=[],L=[],C={};for(y=0;y<o.features.length;++y){L[y]=0,b[y]=0,C[y]=[];for(_=0;_<256;++_)C[y][_]=0}qe.firstVoronoiByInterComm=[];var w=qe.firstVoronoiByInterComm;for(y=0;y<o.features.length;++y)w[y]=1e4;var P=function(i){for(var c=i.data.result,p=i.data.index,y=i.data.interComm_counts,_=i.data.interComm_means,P=i.data.voronoi_counts,x=i.data.voronoi_means,E=i.data.firstVoronoiByInterComm,k=i.data.voronoi_hist,V=i.data.interComm_hist,S=0;S<n.features.length;++S){f[S]+=P[S],m[S]+=x[S];for(var I=0;I<256;++I)g[S][I]+=k[S][I]}for(S=0;S<o.features.length;++S){L[S]+=y[S],b[S]+=_[S];for(I=0;I<256;++I)C[S][I]+=V[S][I],v[I]+=V[S][I];w[S]>E[S]&&(w[S]=E[S])}if(l.putImageData(c,0,h*p),d++,d==u){if(e==ct.Ecole_path){for(S=0;S<n.features.length;++S)m[S]/=255;for(S=0;S<o.features.length;++S)b[S]/=255}else{for(S=0;S<n.features.length;++S)0!=f[S]&&(m[S]/=f[S]);for(S=0;S<o.features.length;++S)0!=L[S]&&(b[S]/=L[S])}var j=[70,140],T=r.toDataURL("png");Ue.updateCirclePreviewLayer();var F=null;if(ct.layers[e]&&ct.layers[e].useColorScheme){var M=lt.range(256),$=lt.getColorsFromScheme(ct.layers[e].colorScheme);F=d3.scale.linear().range($).domain(M)}ct.layers[e]&&ct.layers[e].useColorScheme&&($=lt.getColorsFromScheme(ct.layers[e].colorScheme)),qe.cachedLayers[s]={url:T,tl_lat:t.tl_lat,tl_lng:t.tl_lng,br_lat:t.br_lat,br_lng:t.br_lng,width:r.width,height:r.height,voronoi_means:m,interComm_means:b,voronoi_hist:g,entire_hist:v,interComm_hist:C,hist_buckets:j,percentiles:t.percentiles,layerUrl:s,colorScale:F},console.log("Processed layer:",s),a()}},x=lt.range(256),E=[];if(ct.layers[e]&&ct.layers[e].useColorScheme)E=lt.getColorsFromScheme(ct.layers[e].colorScheme);else{var k=lt.computeColorRange(t.percentiles,ct.layers[e].colors),V=k[0],S=k[1],I=d3.scale.linear().range(S).domain(V);for(y=0;y<256;++y){var j=d3.rgb(I(y));E.push("rgb("+j.r+","+j.g+","+j.b+")")}}for(var T=0;T<u;T++){var F=new Worker("assets/pictureProcessor.js");F.onmessage=P;var M=l.getImageData(0,h*T,r.width,h);F.postMessage({canvasData:M,pixels:i,index:T,length:p,width:r.width,height:r.height,voronoiContainmentData:qe.voronoiContainment.data,interCommContainmentData:qe.interCommContainment.data,numVoronois:n.features.length,numInterComms:o.features.length,tl_lat:t.tl_lat,tl_lng:t.tl_lng,br_lat:t.br_lat,br_lng:t.br_lng,colorDomain:x,colorRange:E})}})}}function dt(e,t){var a=qe.update_parameters,r=qe.imgs;if(!e)return a.hide=!0,void Ue.updateMap();var n=e;t&&(n=ct.layers[e].future),this.loadLayer(e,t,function(){e==ct.EV_path?r.attr("clip-path",""):r.attr("clip-path","url(#clip)");var t=qe.cachedLayers[n];a.tl=new L.LatLng(t.tl_lat,t.tl_lng),a.br=new L.LatLng(t.br_lat,t.br_lng),a.currentGeoLat=qe.currentGeoLat,a.currentGaoLng=qe.currentGeoLng;if(ct.layers[e].useColorScheme)lt.range(256),lt.getColorsFromScheme(ct.layers[e].colorScheme,ct.layers[e].invertColorScheme);else{var o=lt.computeColorRange(t.percentiles,ct.layers[e].colors);o[0],o[1]}var s=t.colorScale;qe.voronoi.style("fill",function(a,r){return e==ct.EV_path?"#00000011":s(t.voronoi_means[r])}),qe.interComms.style("fill",function(a,r){return-1==qe.highlightedInterComm?ct.layers[e].useColorScheme?s(t.interComm_means[r]):"#00000011":r!=qe.highlightedInterComm?"#000":void 0}),qe.canvas.width=t.width,qe.canvas.height=t.height,a.hide=!1,Ue.updateMap(),qe.currentLayerPath=e,r.attr("xlink:href",t.url),d3.select(qe.legend_element).style("display","none"),e!=ct.EV_path&&(d3.select(qe.legend_element).style("display","block"),lt.fillScale(qe.color_legend_canvas,qe.color_legend_svg,s,ct.layers[e].min_value,ct.layers[e].max_value,ct.layers[e].invertColorScheme))}),qe.isFuture=t,Ue.updateCirclePreviewLayer(),Ue.update_chart(qe.currentLayerPath),Ue.update_text_school(qe.currentLayerPath),Ue.update_EV_preview(qe.lastMousePosition.x,qe.lastMousePosition.y)}function pt(e){qe.imgs_EV.attr("xlink:href",qe.cachedLayers[ct.EV_path].url)}var ht={loadLayer:ut,setLayer:dt,setEVLayer:pt},mt=a("7dc5");function ft(e){function t(t,a){return qe.firstVoronoiByInterComm[e]<=a&&(e==qe.interComm_shape.features.length-1||qe.firstVoronoiByInterComm[e+1]>a)?1:0}return t}function gt(e,t,a){return e.append("g").selectAll("path").data(qe.voronoi_shape.features).enter().append("path").attr("d",qe.pathGenerator).attr("vector-effect","non-scaling-stroke").style("stroke","#666").style("fill-opacity",t).style("stroke-opacity",t).on("mouseover",function(e,a){d3.select(this).style("fill-opacity",t),qe.defs_path.datum(e.geometry),Ue.update_clip(),qe.currentChartIndex=a,qe.currentChartIndexIsVoronoi=!0,Ue.update_chart(qe.currentLayerPath),Ue.update_text_school(qe.currentLayerPath),-1!=qe.highlightedInterComm&&qe.onNewName(qe.interComm_shape.features[qe.highlightedInterComm].properties.nomgroup)}).on("mouseout",function(e,t){-1!=qe.highlightedInterComm&&(d3.select(this).style("fill-opacity",ft(qe.highlightedInterComm)(e,t)),d3.select(this).style("stroke-opacity",ft(qe.highlightedInterComm)(e,t))),qe.defs_path.datum([]),Ue.update_clip(),qe.svg_EV.style("display","none"),qe.svg_circle_EV.style("display","none"),qe.currentChartIndex=-1,Ue.update_chart(qe.currentLayerPath),Ue.update_text_school(qe.currentLayerPath),qe.lastMousePosition={x:-300,y:-300}}).on("dblclick",function(e,r){qe.interComms.style("pointer-events","all"),qe.map.fitBounds(qe.initialBounds),qe.highlightedInterComm=-1,qe.interComms.style("fill",function(e,t){return mt.layers[qe.currentLayerPath].useColorScheme?qe.cachedLayers[qe.currentLayerPath].colorScale(qe.cachedLayers[qe.currentLayerPath].interComm_means[t]):"#00000011"}),qe.interComms.style("fill-opacity",a),qe.voronoi.style("fill-opacity",t),qe.voronoi.style("stroke-opacity",t),qe.defs_path.datum([]),Ue.update_clip(),qe.svg_EV.style("display","none"),qe.svg_circle_EV.style("display","none")}).on("mousemove",function(){d3.event&&d3.event.clientX&&d3.event.clientY&&qe.currentLayerPath!=mt.EV_path?(qe.lastMousePosition={x:d3.event.clientX,y:d3.event.clientY-qe.mapElement.getBoundingClientRect().top},Ue.update_EV_preview(qe.lastMousePosition.x,qe.lastMousePosition.y)):(qe.svg_EV.style("display","none"),qe.svg_circle_EV.style("display","none"))}).on("mousedown",function(){d3.event&&d3.event.clientX&&d3.event.clientY&&qe.currentLayerPath!=mt.EV_path&&(qe.lastMouseDownX=d3.event.clientX,qe.lastMouseDownY=d3.event.clientY-qe.mapElement.getBoundingClientRect().top)})}function vt(e,t,a,r){return e.append("g").selectAll("path").data(qe.interComm_shape.features).enter().append("path").attr("d",qe.path).attr("vector-effect","non-scaling-stroke").style("stroke","#333").attr("fill","#fff").attr("fill-opacity",r).style("pointer-events","all").on("mouseover",function(e,t){-1!=qe.highlightedInterComm?t!=qe.highlightedInterComm&&(mt.layers[qe.currentLayerPath].useColorScheme?d3.select(this).style("fill",qe.cachedLayers[qe.currentLayerPath].colorScale(qe.cachedLayers[qe.currentLayerPath].interComm_means[t])):d3.select(this).style("fill","#00000011"),d3.select(this).style("fill-opacity",r)):d3.select(this).style("fill-opacity",a),qe.currentChartIndex=t,qe.currentChartIndexIsVoronoi=!1,Ue.update_chart(qe.currentLayerPath),Ue.update_text_school(qe.currentLayerPath),qe.onNewName(qe.interComm_shape.features[t].properties.nomgroup)}).on("mouseout",function(e,t){-1!=qe.highlightedInterComm?t!=qe.highlightedInterComm&&(d3.select(this).style("fill","#000"),d3.select(this).style("fill-opacity",a)):d3.select(this).style("fill-opacity",r),qe.svg_EV.style("display","none"),qe.svg_circle_EV.style("display","none"),qe.currentChartIndex=-1,Ue.update_chart(qe.currentLayerPath),Ue.update_text_school(qe.currentLayerPath),qe.lastMousePosition={x:-300,y:-300},qe.onNewName("")}).on("click",function(e,r){if(!(!d3.event||!d3.event.clientX||!d3.event.clientY||Math.abs(d3.event.clientX-qe.lastMouseDownX)>=5||Math.abs(d3.event.clientY-qe.mapElement.getBoundingClientRect().top-qe.lastMouseDownY)>=5)){qe.interComms.style("pointer-events","all"),d3.select(this).style("pointer-events","none"),qe.interComms.style("fill","#000"),qe.interComms.style("fill-opacity",a),d3.select(this).style("fill-opacity",t),qe.highlightedInterComm=r,qe.voronoi.style("fill-opacity",ft(r)),qe.voronoi.style("stroke-opacity",ft(r));var n=d3.select(this).node().getBBox(),o=qe.map.layerPointToLatLng(L.point(n.x,n.y)),s=qe.map.layerPointToLatLng(L.point(n.x+n.width,n.y+n.height));qe.map.fitBounds(L.latLngBounds(o,s)),qe.svg_EV.attr("style","display:none;"),qe.svg_circle_EV.attr("style","display:none;")}}).on("mousemove",function(){d3.event&&d3.event.clientX&&d3.event.clientY&&qe.currentLayerPath!=mt.EV_path?(qe.lastMousePosition={x:d3.event.clientX,y:d3.event.clientY-qe.mapElement.getBoundingClientRect().top},Ue.update_EV_preview(qe.lastMousePosition.x,qe.lastMousePosition.y)):(qe.svg_EV.style("display","none"),qe.svg_circle_EV.style("display","none"))}).on("mousedown",function(){d3.event&&d3.event.clientX&&d3.event.clientY&&(qe.lastMouseDownX=d3.event.clientX,qe.lastMouseDownY=d3.event.clientY-qe.mapElement.getBoundingClientRect().top)})}var yt={defineVoronoi:gt,defineInterComms:vt},_t=function(e,t,a,r,n,o,s,l,c,u,d,p){qe.interComm_shape=o,qe.voronoi_shape=s,qe.onHistChange=u,qe.onSchools=d,qe.onNewName=p,qe.legend_element=r,qe.interCommContainment=l,qe.voronoiContainment=c,qe.mapElement=e,document.body.addEventListener("keypress",lt.handleKeyEvent);var h=new L.LatLng(i.viewport.topLatitude,i.viewport.leftLongitude),m=new L.LatLng(i.viewport.bottomLatitude,i.viewport.rightLongitude);function f(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){lt.setLocation(e.coords.latitude,e.coords.longitude)})}qe.initialBounds=L.latLngBounds(h,m),d3.select(r).style("display","none"),qe.color_legend_canvas=d3.select(r).append("canvas"),qe.color_legend_svg=d3.select(r).append("svg"),qe.color_legend_svg.append("g"),f(),lt.createMap(e),L.geoJson(o,{style:lt.blankStyle}).addTo(qe.map);var g=d3.select(e).select(".leaflet-zoom-animated");function v(e,t){var a=qe.map.latLngToLayerPoint(new L.LatLng(t,e));this.stream.point(a.x,a.y)}var y=d3.geo.transform({point:v});qe.pathGenerator=d3.geo.path().projection(y);var _=g.append("defs");qe.defs_path=_.append("path").attr("id","clip_path"),_.append("clipPath").attr("id","clip").append("use").attr("xlink:href","#clip_path"),qe.imgs=g.selectAll("image").data([0]).enter().append("svg:image").attr("x",0).attr("y",0).attr("xlink:href","").attr("clip-path","").attr("preserveAspectRatio","none").style("object-fit","cover"),Ue.update_clip();var b=0,C=.4,w=1;qe.svg_EV=d3.select(t).attr("style","display:none;"),qe.svg_circle_EV=d3.select(a).attr("style","display:none;"),qe.imgs_EV=qe.svg_EV.selectAll("image").data([0]).enter().append("svg:image").attr("x",0).attr("y",0).attr("xlink:href","").attr("preserveAspectRatio","none").style("object-fit","cover");var P=qe.svg_EV.append("g");P.selectAll("path").data([o.features[0]]).enter().append("path").attr("vector-effect","non-scaling-stroke").style("stroke","#000").style("fill-opacity",0).style("stroke-opacity",1),qe.voronoi=yt.defineVoronoi(g,b,w),qe.interComms=yt.defineInterComms(g,b,C,w),qe.markerIcon={iconUrl:"assets/marker.png",iconSize:[24,24],iconAnchor:[12,24]},qe.markerElement=g.append("g").selectAll("image").data([0]).enter().append("svg:image").attr("xlink:href",qe.markerIcon.iconUrl).attr("width",qe.markerIcon.iconSize[0]).attr("height",qe.markerIcon.iconSize[1]).attr("visibility","hidden").style("pointer-events","none"),qe.canvas=document.createElement("canvas"),qe.update_parameters={hide:!0},qe.map.on("viewreset",function(){Ue.updateMap()});var x=qe.map.zoomOut.bind(qe.map),E=qe.map.zoomIn.bind(qe.map);return[ht.loadLayer,ht.setLayer,lt.setLocation,ht.setEVLayer,x,E]},bt={props:["layers","currentLayerPath","currentLocation","currentZoom","isFuture"],data:function(){return{loadLayer:function(){},setLayer:function(){},setLocation:function(){},setEVLayer:function(){},zoomMinus:function(){},zoomPlus:function(){}}},computed:{isEspacesVerts:function(){return this.currentLayerPath==i.EV_path},currentLayerId:function(){return i.layers[this.currentLayerPath].id},currentUnit:function(){if(this.currentLayerPath)return this.$t("layers.".concat(this.currentLayerId,".unit"))},forestColor:function(){return i.layers[i.EV_path].colors[0]},waterColor:function(){return i.layers[i.EV_path].colors[1]},greenColor:function(){return i.layers[i.EV_path].colors[2]},futureColor:function(){return i.color_future},presentColor:function(){return i.color_present},currentYear:function(){return(new Date).getFullYear()},hasFutureAvailable:function(){return!!i.layers[this.currentLayerPath].future}},mounted:function(){var e=this,t="data/intercommunalites.geojson",a="data/voronois.json",r="data/intercomm_cont.json",n="data/voronoi_cont.json";queue().defer(d3.json,t).defer(d3.json,a).await(function(t,a,o){lt.loadContainmentFile(n).then(function(n){lt.loadContainmentFile(r).then(function(r){var s=_t(e.$refs.map,e.$refs.svg,e.$refs.circle_svg,e.$refs.legend,t,a,o,r,n,function(t,a){return e.$emit("newHistogram",t,a)},function(t){return e.$emit("newSchools",t)},function(t){return e.$emit("newName",t)}),l=Object(J["a"])(s,6);e.loadLayer=l[0],e.setLayer=l[1],e.setLocation=l[2],e.setEVLayer=l[3],e.zoomMinus=l[4],e.zoomPlus=l[5],Object.keys(i.layers).forEach(function(t){e.layers[t].path=t,e.loadLayer(t,!1,function(){e.layers[t].loaded=!0,i.EV_path}),i.layers[t].future&&(console.log("Preloading future layer:",i.layers[t].future),e.loadLayer(t,!0,function(){}))}),e.setLayer(e.currentLayerPath)})})})},watch:{currentLayerPath:function(){this.setLayer(this.currentLayerPath,this.hasFutureAvailable&&this.isFuture)},isFuture:function(){this.setLayer(this.currentLayerPath,this.hasFutureAvailable&&this.isFuture)},currentLocation:function(e){var t=Object(J["a"])(e,2),a=t[0],r=t[1];this.setLocation(a,r)},currentZoom:function(e,t){e<t?this.zoomMinus():this.zoomPlus()}}},Lt=bt,Ct=(a("894b"),Object(p["a"])(Lt,Z,W,!1,null,null,null));Ct.options.__file="Map.vue";var wt=Ct.exports,Pt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"sidebar"},[!e.isEspacesVerts&&e.currentLayerPath&&e.layers[e.currentLayerPath].loaded?[a("article",[a("h2",[e._v(e._s(e.$t("layers."+e.currentLayerId+".title")))]),a("div",{domProps:{innerHTML:e._s(e.$t("layers."+e.currentLayerId+".content"))}})]),a("article",{staticClass:"contextual-info"},[e.interCommName?a("h4",[e._v("\n        "+e._s(e.interCommName)+"\n      ")]):a("h4",[e._v("\n        "+e._s(e.$t("sidebar.whole-region"))+"\n      ")]),e.interCommName&&e.schoolCount?a("p",{domProps:{innerHTML:e._s(e.$t("sidebar.child-count",{count:e.schoolCount}))}}):e._e(),a("Histogram",{attrs:{x:e.currentHistogramX,y:e.currentHistogramY,currentLayerPath:e.currentLayerPath}})],1)]:[a("article",[a("h2",[e._v(e._s(e.$t("intro.title")))]),a("p",{domProps:{innerHTML:e._s(e.$t("intro.about"))}}),a("p",{domProps:{innerHTML:e._s(e.$t("intro.start"))}}),a("p",{domProps:{innerHTML:e._s(e.$t("intro.future"))}})]),a("article",{staticClass:"about"},[a("p",{domProps:{innerHTML:e._s(e.$t("intro.credits"))}}),e._m(0)])]],2)},xt=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"slideshow"},[a("a",{attrs:{href:"https://www.epfl.ch/"}},[a("img",{attrs:{src:"assets/epfl.png",alt:"Logo EPFL"}})]),a("a",{attrs:{href:"https://naturalcapitalproject.stanford.edu/"}},[a("img",{attrs:{src:"assets/natcap.jpg",alt:"Logo NatCap"}})])])}],Et=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"histogram"},[a("svg",{ref:"svg"})])},kt=[],Vt={props:["x","y","currentLayerPath"],data:function(){return{updateChart:function(e){}}},mounted:function(){var e=this,t={top:5,right:10,bottom:45,left:65},a=380,r=250,n=a-t.left-t.right,o=r-t.top-t.bottom,s=d3.scaleLinear().rangeRound([0,n]),l=d3.scaleLinear().rangeRound([o,0]),c=d3.select(this.$refs.svg).attr("width",a).attr("height",r).append("g").attr("transform","translate(".concat(t.left,", ").concat(t.top,")")),u=c.append("g").attr("transform","translate(0, ".concat(o,")")),d=c.append("g"),p=(c.append("text").attr("transform","rotate(-90)").attr("x",0-o/2).attr("y",0-t.left).attr("dy","1em").style("text-anchor","middle").style("font-size","9pt").style("font-style","italic").text(this.$t("sidebar.number-points")),c.append("text").attr("transform","translate(".concat(n/2," , ").concat(r-10,")")).style("text-anchor","middle").style("font-size","9pt").style("font-style","italic").text(this.$t("layers.".concat(this.currentLayerId,".hist_legend"))));this.updateChart=function(t,a){var r=t.map(function(e,t){return{x:e,y:a[t]}}),h=i.layers[e.currentLayerPath],m=d3.scaleLinear().domain([0,255]).range([h.min_value,h.max_value]),f=d3.scale.linear().range(lt.getColorsFromScheme(h.colorScheme)).domain(t);p.text(h.hist_legend);var g=t.filter(function(e){return a[e]>0}),v=g[0],y=g.slice(-1)[0],_=d3.max(a),b=s.domain([v,y]),L=l.domain([0,_]);d.call(d3.axisLeft(L)),u.call(d3.axisBottom(b).ticks(5).tickFormat(function(e){return m(e).toPrecision(3)}).tickPadding(6));var C=c.selectAll("rect").data(r,function(e){return e.x});C.enter().append("rect").attr("class","bar").attr("x",1).merge(C).attr("transform",function(e){return"translate(".concat(b(e.x),", ").concat(L(e.y),")")}).attr("width",function(e){return Math.ceil(n/(y-v))+1}).attr("height",function(e){return o-L(e.y)}).attr("fill",function(e){return f(e.x)}).exit().remove()},this.updateChart(this.x,this.y)},watch:{x:function(){this.updateChart(this.x,this.y)}},computed:{currentLayerId:function(){return i.layers[this.currentLayerPath].id}}},St=Vt,It=(a("8ed3"),Object(p["a"])(St,Et,kt,!1,null,null,null));It.options.__file="Histogram.vue";var jt=It.exports,Tt={props:["layers","currentLayerPath","currentHistogramX","currentHistogramY","schoolCount","interCommName"],components:{Histogram:jt},computed:{isEspacesVerts:function(){return this.currentLayerPath==i.EV_path},currentLayerId:function(){return i.layers[this.currentLayerPath].id}}},Ft=Tt,Mt=(a("f203"),Object(p["a"])(Ft,Pt,xt,!1,null,null,null));Mt.options.__file="Sidebar.vue";var $t=Mt.exports,Nt=i.EV_path,zt={components:{Intro:m,Tutorial:C,About:V,ZoomControl:M,LocationControl:O,Layers:U,Map:wt,Sidebar:$t},data:function(){return{layers:Object.keys(i.layers).reduce(function(e,t){return e[t]=i.layers[t],e[t].loaded=!1,e[t].path=t,e},{}),isFuture:!1,currentLayerPath:Nt,currentZoom:0,currentLocation:null,currentHistogramX:null,currentHistogramY:null,introVisible:!0,sidebarVisible:!1,aboutVisible:!1,currentTutorialStep:1,interCommName:"",schoolCount:null}},computed:{currentLayerLoaded:function(){return this.layers[this.currentLayerPath].loaded}},methods:{logKey:function(e){console.log(e)}}},qt=zt,Ht=(a("5c0b"),Object(p["a"])(qt,o,s,!1,null,null,null));Ht.options.__file="App.vue";var Dt=Ht.exports,Ot=a("f693"),At=a("edd4");r["a"].config.productionTip=!1,r["a"].use(n["a"]),new r["a"]({render:function(e){return e(Dt)},i18n:new n["a"]({locale:"fr",messages:{fr:Ot,en:At}})}).$mount("#app")},"5c0b":function(e,t,a){"use strict";var r=a("5e27"),n=a.n(r);n.a},"5e27":function(e,t,a){},"7dc5":function(e){e.exports={layers:{"data/rasters/espaces_verts.json":{id:"espaces-verts",colorScheme:0,useColorScheme:!1,colors:["#006400","#356FD7","#90EE90"],min_value:0,max_value:0,color:"#d2f8d2",active_color:"#8FBC8F"},"data/rasters/pollination_ref.json":{id:"pollination",colorScheme:0,useColorScheme:!0,min_value:0,max_value:.123434,future:"data/rasters/pollination_cc.json"},"data/rasters/T_reduction.json":{id:"reduction",colorScheme:1,useColorScheme:!0,invertColorScheme:!0,min_value:-.210985,max_value:-2.45584,future:"data/rasters/T_reduction.json"},"data/rasters/L_ref.json":{id:"nappes",colorScheme:2,useColorScheme:!0,min_value:0,max_value:771.576,future:"data/rasters/L_cc.json"},"data/rasters/n_ret_ref.json":{id:"nutriments",colorScheme:3,useColorScheme:!0,min_value:48.7002,max_value:100,future:"data/rasters/n_ret_cc.json"},"data/rasters/correlation_ref.json":{id:"hotspots",colorScheme:4,useColorScheme:!0,min_value:0,max_value:100,future:"data/rasters/correlation_cc.json"},"data/rasters/ecoles_elementaires.json":{colorScheme:0,useColorScheme:!0,min_value:0,max_value:0,hidden:!0}},viewport:{topLatitude:49.23719070644322,bottomLatitude:48.12054154281846,leftLongitude:1.44727950476602,rightLongitude:3.555686958558566},EV_path:"data/rasters/espaces_verts.json",Ecole_path:"data/rasters/ecoles_elementaires.json",Urban_cooling:"data/rasters/T_reduction.json",Correlation:"data/rasters/correlation_ref.json",color_ev:"#82d173",color_present:"#90c2e7",color_future:"#9f86c0","":"4 - red"}},"894b":function(e,t,a){"use strict";var r=a("a130"),n=a.n(r);n.a},"8ed3":function(e,t,a){"use strict";var r=a("3664"),n=a.n(r);n.a},"91fa":function(e,t,a){"use strict";var r=a("a90f"),n=a.n(r);n.a},a130:function(e,t,a){},a90f:function(e,t,a){},b08f:function(e,t,a){},bed8:function(e,t,a){"use strict";var r=a("2a3c"),n=a.n(r);n.a},d05b:function(e,t,a){},edd4:function(e){e.exports={intro:{title:"Welcome on EcoParis.",about:'EcoParis is an interactive visualization of map data of ecosystem services in urban and peri-urban areas in the Ile-de-France region from the <a href="https://idefese.wordpress.com/">IDEFESE</a> project.',start:"For starters, you can select a layer to display among nutrient retention, temperature reduction, pollination or groundwater recharge measurements.",future:"You can also choose to display the estimated evolution of these measures by 2030 in a climate change scenario.",credits:'EcoParis has been designed by students of the <a href="https://edu.epfl.ch/coursebook/en/data-visualization-COM-480">Data Visualization</a> course at EPFL, with the help of Perrine Hamel of the Stanford <a href="https://naturalcapitalproject.stanford.edu/">Natural Capital Project</a>.'},sidebar:{"whole-region":"All of the Île-de-France region","child-count":"As children are one of the most vulnerable population groups, it is important to note that there are <b>{count}</b> schools in the selected area.","number-points":"Number of points"},titles:{layers:"Layers",credits:"About"},credits:{title:"Acknowledgements.",what:'EcoParis has been designed by students of the <a href="https://edu.epfl.ch/coursebook/en/data-visualization-COM-480">Data Visualization</a> course at EPFL.',alex:"Alex Ferragni, Master in Computer Science",karthi:"Karthigan Sinnathamby, Master in Data Science",romain:"Romain Liautaud, Master in Communication Systems",collaborators:'This project has been realized in colloboration with the Stanford <a href="https://naturalcapitalproject.stanford.edu/">Natural Capital Project</a> which objective is to develop scientific based approaches to put forward the natural benefits in the eyes of the society, in order to take the natural heritage in the decision-making process.',"credits-1":'The dataset on the nutrient retention, pollination and groundwater recharge measurements have been computed by Emmanuel Faure for his <a href="https://www.dropbox.com/s/s4ccqoz7yg38sgw/Faure_memoire.pdf?dl=0">Master thesis</a> and remain preliminary. The data computation and its limits are described in the thesis.',"credits-2":'The data on the cooling service are only illustrative, waiting for the results on the <a href="https://idefese.wordpress.com/">IDEFESE</a> project. The data on the <a href="http://data.iau-idf.fr/datasets?q=espaces+verts&sort_by=relevance">green spaces</a> and on the <a href="http://data.iau-idf.fr/datasets?q=r%C3%A9seau+hydrographique+principal+simplifi%C3%A9+d%27%C3%8Ele-de-france&sort_by=relevance">water network</a> comes from the Ile-de-France IAU.',thanks:"Our deepest thanks to Perrine Hamel, senior scientist at Natural Capital Project,and to Emmanuel Faure for the description in French of the natural services.",logo:'The logo of the parrot was made by <a href="https://www.flaticon.com/authors/freepik">Freepik</a> for <a href="http://www.flaticon.com/">Flaticon</a>.'},tutorial:{1:"Welcome to <i>EcoParis</i>. To skip to the visualization, press Escape. To continue the tutorial, press the right key.",2:"This visualization revolves around the Île-de-France region, on which you can overlay several ecosystem measures.",3:"The legend is visible at the bottom right, and indicates that you are currently viewing a map of the natural areas of the region.",4:"You can use the menu on the left to choose a measure to display, or to place your current position on the map.",5:"For example, select the measurement of groundwater recharge.",6:"The right part of the screen gives you more information about the selected measurement, as well as its distribution as a histogram.",7:"For some measurements, you can also choose between current data and a prediction by 2030 under a climate change scenario.",8:"Move your mouse over the map. The histogram changes according to the inter-municipality overflown, and the green spaces under your cursor are displayed in a bubble.",9:'You can disable the bubble by pressing <span class="keycap">X</span>. You can use the bubble to see future predictions by pressing <span class="keycap">SPACE</span>.',10:"You can click on an intermunicipal to observe it in detail, and double-click to return to the general view.",11:"Finally, select the measure of Hotspots. It is an aggregate of the other measures, and quantifies the natural benefits in an area.",12:"With the help of the bubble, you can see the link between natural areas and hotspots. Now you have to look for other links !",skip:"Skip",next:"Next"},legend:{"natural-spaces":"Natural spaces",wood:"Wooden areas",water:"Rivers and <br />bodies of water",leisure:"Green spaces and <br />leisure areas"},layers:{"espaces-verts":{name:"Green Sp.",icon:"G"},pollination:{name:"Polli.",icon:"P",title:"Pollination measurement.",content:"<p>For many flowering plants, the realization of the sexual cycle involves the intervention of pollinating animals, which allows the encounter of gametes by their behavior of food intake. The abundance of pollinators is therefore a determining factor of agricultural yield accounting for 75% of human cultures.</p><p style='text-align: center;'><a class='button dark' href='http://data.naturalcapitalproject.org/nightly-build/invest-users-guide/html/croppollination.html' target='_blank'>Learn more</a></p>",hist_legend:"Pollination abundance index",unit:"Abundance index"},reduction:{name:"Temp.",icon:"T",title:"Cooling service.",content:"<p>The cooling service can reach several degrees. It reduces health risks (cardiovascular diseases and deaths directly related to heatwaves) and potentially the energy consumption associated with air conditioning. </p><p style='text-align: center;'><a class='button dark' href='https://www.iucn.org/content/nature-cools-when-things-heat' target='_blank'>Learn more</a></p>",hist_legend:"Cooling (in °C)",unit:"in °C"},nappes:{name:"Water",icon:"GW",title:"Groundwater recharge measurement.",content:"<p>This measure quantifies the retention of rainwater by ecosystems upstream of waterways. It establishes, for each pixel, a monthly water assesment to compute the amount of rainwater infiltrating the groundwater, net of water flow and evapotranspiration. The majority of exploitation for the production of water intended for human consumption exploit groundwater. With the effects of climate change, more pronounced and more frequent weather events, droughts or intense rain events, will impact water resources. </p><p style='text-align: center;'><a class='button dark' href='http://data.naturalcapitalproject.org/nightly-build/invest-users-guide/html/seasonal_water_yield.html' target='_blank'>Learn more</a></p>",hist_legend:"Groundwater recharge (in mm/year)",unit:"in mm/year"},nutriments:{name:"Nutri.",icon:"NU",title:"Nutrient retention measurement.",content:"<p>The measure aims at estimating the quantities of nitrogen and phosphorus retained annually upstream of the hydrographic network after a diffuse deposit. The retention service makes it possible to improve the quality of the water (superficial and underground). It is directly useful to water management organizations (unions and sanitation department), and therefore to residents whose taxes finance the maintenance of sanitation services.</p><p style='text-align: center;'p><a class='button dark' href='http://data.naturalcapitalproject.org/nightly-build/invest-users-guide/html/ndr.html' target='_blank'>Know more</a></p>",hist_legend:"Nutrient retention (in % of absorption)",unit:"in % of absorption"},hotspots:{name:"Hotspots",icon:"H",title:"Natural hotspots.",content:"<p>A multi-criteria indicator has been calculated to identify service hotspots. The measurement consists of the average of the four service values ​​(nutrient retention, groundwater recharge, cooling and pollination), previously standardized (linear transformation to values ​​between 0 and 1). The more natural spaces there are, the more the quantity of service increases while depending on the biophysical processes specific to each service. </p><p style='margin-bottom:0'>Formula : (P<sub>n</sub> + Nu<sub>n</sub> + Na<sub>n</sub> + T<sub>n</sub>) &frasl; 4</p><ul><li>Pollination: P<sub>n</sub> = P &frasl; max(P)</li><li>Nutrient retention: Nu<sub>n</sub> = Nu &frasl; max(Nu)</li><li>Groundwater recharge: Na<sub>n</sub> = Na &frasl; max(Na)</li><li>Cooling: T<sub>n</sub> = T &frasl; max(T)</li></ul>",hist_legend:"",unit:""}}}},f203:function(e,t,a){"use strict";var r=a("0466"),n=a.n(r);n.a},f27d:function(e,t,a){"use strict";var r=a("0f8a"),n=a.n(r);n.a},f358:function(e,t,a){"use strict";var r=a("b08f"),n=a.n(r);n.a},f693:function(e){e.exports={intro:{title:"Bienvenue sur EcoParis.",about:'EcoParis est une visualisation interactive des données cartographiques des services écosystémiques en territoires urbains et péri-urbains en région Ile-de-France issues du projet <a href="https://idefese.wordpress.com/">IDEFESE</a>.',start:"Pour commencer, vous pouvez sélectionner une couche à afficher parmi des mesures de rétention de nutriment, réduction de la température, pollinisation ou encore de rechargement des nappes phréatiques.",future:"Vous pouvez aussi choisir d'afficher l'évolution estimée de ces mesures à l'horizon 2030 dans un scénario de changement climatique.",credits:'EcoParis a été conçu par des élèves du cours de <a href="https://edu.epfl.ch/coursebook/en/data-visualization-COM-480">Data Visualization</a> de l\'EPFL, avec l\'aide de Perrine Hamel du projet <a href="https://naturalcapitalproject.stanford.edu/">Natural Capital Project</a> de Stanford.'},sidebar:{"whole-region":"Toute la région Île-de-France","child-count":"Les enfants étant l'une des catégories de population vulnérables aux canicules, il est important de noter qu'il y a <b>{count}</b> établissements scolaires dans la zone sélectionnée.","number-points":"Nombre de points"},titles:{layers:"Couches",credits:"À propos"},credits:{title:"Réalisation et remerciements.",what:"EcoParis a été conçu par trois étudiants de l'EPFL pendant le semestre d'automne 2018 dans le cadre du cours de <a href=\"https://edu.epfl.ch/coursebook/en/data-visualization-COM-480\">Data Visualization</a>.",alex:"Alex Ferragni, Master d'Informatique",karthi:"Karthigan Sinnathamby, Master en Data Science",romain:"Romain Liautaud, Master en Systèmes de Communication",collaborators:'Ce projet a été réalisé en colloboration avec <a href="https://naturalcapitalproject.stanford.edu/">Natural Capital Project</a> de Stanford dont la mission consiste à développer des approches scientifiques pour mettre en avant les bénéfices de la nature aux yeux de la société dans le but d\'incorporer le patrimoine naturel dans la prise de décision.',"credits-1":'Les données sur les services de rétention des nutriments, recharge des nappes, et pollinisation ont été créées par Emmanuel Faure pour son <a href="https://www.dropbox.com/s/s4ccqoz7yg38sgw/Faure_memoire.pdf?dl=0">mémoire de thèse de Master</a> et restent préliminaires. Le calcul des données ainsi que les limitations sont décrites dans le mémoire.',"credits-2":'Les données sur le service de rafraîchissement ne sont fournies qu\'à titre illustratif, en attendant les résultat des travaux du projet <a href="https://idefese.wordpress.com/">IDEFESE</a>. Les données sur les <a href="http://data.iau-idf.fr/datasets?q=espaces+verts&sort_by=relevance">espaces verts</a> et sur le <a href="http://data.iau-idf.fr/datasets?q=r%C3%A9seau+hydrographique+principal+simplifi%C3%A9+d%27%C3%8Ele-de-france&sort_by=relevance">réseau hydrographique</a> proviennent de l\'IAU Ile-de-France.',thanks:"Nos remerciements à Perrine Hamel, chargée de recherche au Natural Capital Project, et à Emmanuel Faure pour les descriptions en français des services.",logo:'Le logo du perroquet a été réalisé par <a href="https://www.flaticon.com/authors/freepik">Freepik</a> pour <a href="http://www.flaticon.com/">Flaticon</a>.'},tutorial:{1:"Bienvenue sur <i>EcoParis</i>. Pour accéder directement à la visualisation, appuyez sur Echap. Pour continuer le tutoriel, appuyez sur la flèche droite.",2:"Cette visualisation est articulée autour d'une carte de la région Île-de-France, sur laquelle vous pouvez superposer plusieurs mesures écosystémiques.",3:"La légende est visible en bas à droite, et vous indique que vous visualisez actuellement une carte des espaces naturels de la région.",4:"Vous pouvez utiliser le menu à gauche pour choisir une mesure à afficher, ou encore pour placer votre position actuelle sur la carte.",5:"Sélectionnez par exemple la mesure du rechargement des nappes phréatiques.",6:"La partie droite de l'écran vous donne plus d'informations sur la mesure sélectionnée, ainsi que sa distribution sous forme d'histogramme.",7:"Pour certaines mesures, vous pouvez aussi choisir entre les données actuelles et une prédicition à l'horizon 2030 sous un scénario de changement climatique.",8:"Déplacez votre souris sur la carte. L'histogramme change selon l'intercommunalité survolée, et les espaces verts sous votre curseur sont affichés dans une bulle.",9:'Vous pouvez désactiver la bulle en pressant <span class="keycap">X</span>. Vous pouvez utiliser la bulle pour voir les prédictions futures en pressant <span class="keycap">ESPACE</span>.',10:"Vous pouvez cliquer sur une intercommunalité pour l'observer en détails, et double-cliquer pour revenir à la vue générale.",11:"Pour finir, sélectionnez la mesure de Hotspots. Elle correspond à un aggrégat des autres mesures, et quantifie les bénéfices naturels dans une zone.",12:"À l'aide de la bulle, vous pouvez constater le lien entre les espaces naturels et les hotspots. À vous maintenant de chercher d'autres liens !",skip:"Quitter",next:"Suivant"},legend:{"natural-spaces":"Espace naturels",wood:"Espaces boisés",water:"Fleuves et <br />espaces en eau",leisure:"Espaces verts et <br />espaces de loisirs"},layers:{"espaces-verts":{name:"Esp. nat.",icon:"E"},pollination:{name:"Polli.",icon:"P",title:"Mesure de la pollinisation",content:"<p>Pour de nombreuses plantes à fleurs, la réalisation du cycle sexuel implique l’intervention d’animaux pollinisateurs, qui permettent la rencontre des gamètes par leur comportement de prise alimentaire. L’abondance de pollinisateurs est donc un facteur déterminant du rendement agricole et ce pour 75% des cultures humaines.</p><p style='text-align: center;'><a class='button dark' href='http://data.naturalcapitalproject.org/nightly-build/invest-users-guide/html/croppollination.html' target='_blank'>En savoir plus</a></p>",hist_legend:"Indice d'abondance de pollinisation",unit:"indice d'abondance"},reduction:{name:"Temp.",icon:"T",title:"Mesure du service de rafraîchissement",content:"<p>Le service de rafraichissement peut atteindre plusieurs degrés. Il réduit les risques sanitaires (maladies cardio-vasculaires et décès directement liés aux canicules) et potentiellement la consommation énergétique associée à la climatisation.</p><p style='text-align: center;'><a class='button dark' href='https://www.iucn.org/content/nature-cools-when-things-heat' target='_blank'>En savoir plus</a></p>",hist_legend:"Raffraichissement (en °C)",unit:"en °C"},nappes:{name:"Nappe",icon:"Na",title:"Mesure du rechargement des nappes",content:"<p>Cette mesure permet de quantifier la rétention des eaux de pluie par les écosystèmes en amont des cours d’eau. Elle établit, pour chaque pixel, un bilan hydrique mensuel permettant de calculer la quantité d’eau pluviale s’infiltrant vers les nappes phréatiques, nette du ruissellement et de l’évapotranspiration. La majorité des captages pour la production d’eaux destinées à la consommation humaine exploitent des eaux souterraines. Avec les effets du changement climatique, des aléas météorologiques plus marqués et plus fréquents, sécheresses ou épisodes pluvieux intenses, vont impacter les ressources en eau.</p><p style='text-align: center;'><a class='button dark' href='http://data.naturalcapitalproject.org/nightly-build/invest-users-guide/html/seasonal_water_yield.html' target='_blank'>En savoir plus</a></p>",hist_legend:"Rechargement des nappes (en mm/an)",unit:"en mm/an"},nutriments:{name:"Nutri.",icon:"Nu",title:"Mesure de la rétention des nutriments",content:"<p>La mesure vise à estimer les quantités d’azote et de phosphore retenues annuellement en amont du réseau hydrographique après un dépôt diffus. Le service de rétention permet d'améliorer la qualité de l'eau (superficielle et souterraine). Il est directement utile aux organismes de gestion de l'eau (syndicats et département d'assainissement), et donc aux habitants dont les impôts financent la maintenance des services d'assainissement.</p><p style='text-align: center;'p><a class='button dark' href='http://data.naturalcapitalproject.org/nightly-build/invest-users-guide/html/ndr.html' target='_blank'>En savoir plus</a></p>",hist_legend:"Rétention des nutriments (en % d'absorption)",unit:"en % d'absorption"},hotspots:{name:"Hotspots",icon:"H",title:"Hotspots des services",content:"<p>Un indicateur multi-critère a été calculé pour identifier les hotspots de services. La mesure consiste en la moyenne des quatre valeurs de service (rétention des nutriments, rechargement des nappes, rafraîchissement et pollinisation), préalablement normalisées (transformation linéaire vers des valeurs entre 0 et 1). Plus il y a d'espaces naturels, plus la quantité de service augmente tout en dépendant des procédés biophysiques propres à chaque service.</p><p style='margin-bottom:0'>Formule : (P<sub>n</sub> + Nu<sub>n</sub> + Na<sub>n</sub> + T<sub>n</sub>) &frasl; 4</p><ul><li>Pollinisation : P<sub>n</sub> = P &frasl; max(P)</li><li>Rét. nutriment : Nu<sub>n</sub> = Nu &frasl; max(Nu)</li><li>Recharge des nappes : Na<sub>n</sub> = Na &frasl; max(Na)</li><li>Rafraîchissement : T<sub>n</sub> = T &frasl; max(T)</li></ul>",hist_legend:"",unit:""}}}},fcd1:function(e,t,a){}});
//# sourceMappingURL=app.c41ab3b6.js.map