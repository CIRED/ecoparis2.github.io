(function(t){function e(e){for(var n,i,s=e[0],l=e[1],c=e[2],d=0,p=[];d<s.length;d++)i=s[d],r[i]&&p.push(r[i][0]),r[i]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);u&&u(e);while(p.length)p.shift()();return o.push.apply(o,c||[]),a()}function a(){for(var t,e=0;e<o.length;e++){for(var a=o[e],n=!0,s=1;s<a.length;s++){var l=a[s];0!==r[l]&&(n=!1)}n&&(o.splice(e--,1),t=i(i.s=a[0]))}return t}var n={},r={app:0},o=[];function i(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=t,i.c=n,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(a,n,function(e){return t[e]}.bind(null,n));return a},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var u=l;o.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"0466":function(t,e,a){},"054f":function(t,e,a){"use strict";var n=a("fcd1"),r=a.n(n);r.a},"2a3c":function(t,e,a){},"56d7":function(t,e,a){"use strict";a.r(e);a("cadf"),a("551c"),a("097d");var n=a("2b0e"),r=function(){var t=this,e=this,a=e.$createElement,n=e._self._c||a;return n("div",{attrs:{id:"app"}},[n("transition",{attrs:{name:"fade"}},[e.introVisible?n("Intro",{attrs:{onDismiss:function(){e.introVisible=!1,t.currentLayerPath=t.defaultLayer}}}):e._e()],1),n("section",{staticClass:"menu"},[n("LocationControl",{attrs:{onLocation:function(e){return t.currentLocation=e}}}),n("Layers",{attrs:{layers:e.layers},model:{value:e.currentLayerPath,callback:function(t){e.currentLayerPath=t},expression:"currentLayerPath"}})],1),n("section",{staticClass:"container"},[n("Map",{attrs:{layers:e.layers,currentLayerPath:e.currentLayerPath,currentLocation:e.currentLocation,onHist:function(e,a){t.currentHistogramX=e,t.currentHistogramY=a},onSchools:function(t){},appRefs:this.$refs}}),n("svg",{ref:"circle_svg",staticClass:"EV-circle-svg"}),n("svg",{ref:"svg",staticClass:"EV-svg"}),n("div",{ref:"legend",staticClass:"color_legend"}),n("Sidebar",{attrs:{layers:e.layers,currentLayerPath:e.currentLayerPath,EV_path:e.EV_path,currentHistogramX:e.currentHistogramX,currentHistogramY:e.currentHistogramY}})],1)],1)},o=[],i=(a("ac6a"),a("456d"),a("7dc5")),s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"intro"},[t._m(0),a("p",[t._v("Découvrez l'influence de la nature sur votre vie à Paris.")]),a("section",{staticClass:"buttons"},[a("a",{staticClass:"button accent",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.onDismiss(e)}}},[t._v("Commencer")]),a("a",{staticClass:"button",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.onDismiss(e)}}},[t._v("Visite guidée")])])])},l=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("h1",[t._v("\n    EcoParis\n    "),a("img",{attrs:{src:"assets/parrot.svg"}})])}],c={props:["onDismiss"]},u=c,d=(a("91fa"),a("2877")),p=Object(d["a"])(u,s,l,!1,null,null,null);p.options.__file="Intro.vue";var h=p.exports,f=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},m=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"zoom-control"},[a("a",{staticClass:"minus",attrs:{href:"#"}},[t._v("-")]),a("a",{staticClass:"plus",attrs:{href:"#"}},[t._v("+")])])}],v={},g=v,y=(a("bf1e"),Object(d["a"])(g,f,m,!1,null,null,null));y.options.__file="ZoomControl.vue";var _=y.exports,b=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"location-control"},[a("a",{staticClass:"locate",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.locate(e)}}},[a("i",{staticClass:"fas fa-map-marker-alt"})]),a("div",{class:{search:!0,active:t.searchExpanded}},[a("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.toggleSearch(e)}}},[t.searchExpanded?a("i",{staticClass:"fas fa-search-minus"}):a("i",{staticClass:"fas fa-search-location"})]),a("input",{ref:"searchInput",staticClass:"autocomplete",attrs:{type:"text"},on:{keyup:function(e){if(!("button"in e)&&27!==e.keyCode)return null;t.searchExpanded=!1}}})])])},C=[],E={props:["onLocation"],data:function(){return{searchExpanded:!1}},mounted:function(){var t=this,e=new google.maps.places.Autocomplete(this.$refs.searchInput);e.setFields(["geometry"]),e.setOptions({strictBounds:!0}),e.setBounds({north:i.viewport.topLatitude,south:i.viewport.bottomLatitude,west:i.viewport.leftLongitude,east:i.viewport.rightLongitude}),e.addListener("place_changed",function(){var a=e.getPlace();a.geometry?(t.searchExpanded=!1,t.onLocation([a.geometry.location.lat(),a.geometry.location.lng()])):t.onLocation(null,null)})},methods:{locate:function(){var t=this;navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){e&&t.onLocation([e.coords.latitude,e.coords.longitude])})},toggleSearch:function(){this.searchExpanded^=!0,this.$refs.searchInput.focus()},keypressSearch:function(t){alert(JSON.stringify(t))}}},x=E,w=(a("bed8"),Object(d["a"])(x,b,C,!1,null,null,null));w.options.__file="LocationControl.vue";var P=w.exports,V=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"layers"},[a("h3",[t._v("Couches")]),a("div",{staticClass:"buttons"},t._l(t.layers,function(e){return e.hidden?t._e():a("a",{class:{active:t.value==e.path},on:{click:function(a){a.preventDefault(),t.select(e)}}},[a("span",{staticClass:"icon",domProps:{innerHTML:t._s(e.icon)}}),a("span",[t._v(t._s(e.name))]),e.loaded?t._e():a("div",{staticClass:"loader-tile-grid"},[a("div",{staticClass:"loader-tile loader-tile1"}),a("div",{staticClass:"loader-tile loader-tile2"}),a("div",{staticClass:"loader-tile loader-tile3"}),a("div",{staticClass:"loader-tile loader-tile4"}),a("div",{staticClass:"loader-tile loader-tile5"}),a("div",{staticClass:"loader-tile loader-tile6"}),a("div",{staticClass:"loader-tile loader-tile7"}),a("div",{staticClass:"loader-tile loader-tile8"}),a("div",{staticClass:"loader-tile loader-tile9"})])])}),0)])},k=[],S={props:["layers","value"],methods:{select:function(t){t.loading||this.$emit("input",t.path)}}},j=S,I=(a("054f"),Object(d["a"])(j,V,k,!1,null,null,null));I.options.__file="Layers.vue";var M=I.exports,D=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{ref:"map",staticClass:"map"})},O=[],T=a("3835"),B={},H="",Y=null,X=null,$=null,z=null,G=null,A=null,F=null,R=null,N=null,U={},q=null,J=null,Z=null,W=null,K=[],Q=null,tt=null,et=null,at=null,nt=null,rt=null,ot=null,it=-1,st=null,lt={},ct=0,ut=0,dt={cachedLayers:B,currentLayerPath:H,map:Y,currentGeoLat:X,currentGeoLng:$,svg_EV:z,svg_circle_EV:G,interComms:A,voronoi:F,imgs:R,imgs_EV:N,update_parameters:U,markerElement:q,canvas:J,voronoi_shape:Z,interComm_shape:W,firstVoronoiByInterComm:K,pathGenerator:Q,defs_path:tt,legend_element:et,color_legend_canvas:at,color_legend_svg:nt,onSchools:rt,onHistChange:ot,highlightedInterComm:it,initialBounds:st,markerIcon:lt,lastMouseDownX:ct,lastMouseDownY:ut},pt=a("7dc5");function ht(){var t=dt.map,e=dt.cachedLayers,a=dt.currentLayerPath,n=dt.defs_path;function r(n,r){var o=t.latLngToLayerPoint([e[a].tl_lat,e[a].tl_lng]),i=t.latLngToLayerPoint([e[a].br_lat,e[a].br_lng]),s=i.x-o.x,l=i.y-o.y,c=t.latLngToLayerPoint(L.latLng(r,n)),u=(c.x-o.x)/(i.x-o.x)*(s-1),d=(c.y-o.y)/(i.y-o.y)*(l-1);this.stream.point(u,d)}var o=d3.geo.transform({point:r}),i=d3.geo.path().projection(o);n.attr("d",i)}function ft(t,e){var a=dt.svg_EV,n=dt.map,r=dt.cachedLayers,o=dt.imgs_EV,i=pt.EV_path;if(r[pt.EV_path]){a.style("width").substr(0,a.style("width").length-2);var s=parseInt(a.style("width").substr(0,a.style("width").length-2)),l=parseInt(a.style("height").substr(0,a.style("width").length-2));a.attr("style","top:"+(e-l-30)+"px; left:"+(t-s/2)+"px; display:'';"),dt.svg_circle_EV.attr("style","top:"+(e-l/2)+"px; left:"+(t-s/2)+"px; display:'';"),console.l;var c=L.latLng(r[i].tl_lat,r[i].tl_lng),u=L.latLng(r[i].br_lat,r[i].br_lng),d=n.latLngToContainerPoint(c),p=(n.latLngToContainerPoint(u),n.latLngToLayerPoint(u).x-n.latLngToLayerPoint(c).x),h=n.latLngToLayerPoint(u).y-n.latLngToLayerPoint(c).y;o.attr("width",p),o.attr("height",h),o.attr("transform","translate("+(+d.x-t+s/2)+","+(+d.y-e+l/2)+")")}}function mt(t,e,a){var n=dt.cachedLayers,r=n[e];if(r){var o=[];o=1==a?r.voronoi_hist[t]:r.interComm_hist[t],o[0]=0,dt.onHistChange(Mt.range(256),o)}}function vt(t,e,a){var n=dt.cachedLayers;if(e==pt.Urban_cooling){var r=n[pt.Ecole_path];if(!r)return;var o=[];o=1==a?r.voronoi_hist[t]:r.interComm_hist[t],dt.onSchools(o)}else dt.onSchools(null)}function gt(){var t=dt.map,e=dt.currentGeoLat,a=dt.currentGeoLng,n=dt.markerElement;if(e&&a){var r=t.latLngToLayerPoint([e,a]),o=r.x-dt.markerIcon.iconAnchor[0],i=r.y-dt.markerIcon.iconAnchor[1];n.attr("visibility","visible"),n.attr("transform","translate(".concat(o,", ").concat(i,")"))}else n.attr("visibility","hidden")}function yt(){var t=dt.map,e=(dt.cachedLayers,dt.voronoi),a=dt.interComms,n=dt.imgs,r=dt.imgs_EV,o=dt.update_parameters,i=dt.pathGenerator;if(o.hide)return console.log("hidden!"),a.attr("visibility","hidden"),e.attr("visibility","hidden"),n.attr("visibility","hidden"),void r.attr("visibility","hidden");a.attr("visibility","visible"),e.attr("visibility","visible"),n.attr("visibility","visible"),r.attr("visibility","visible");var s=o.tl,l=o.br;console.log("UPDATING");var c=t.latLngToLayerPoint(l).x-t.latLngToLayerPoint(s).x,u=t.latLngToLayerPoint(l).y-t.latLngToLayerPoint(s).y;n.attr("transform",function(e){var a=t.latLngToLayerPoint(s);return"translate("+a.x+","+a.y+")"}),n.attr("width",c),n.attr("height",u),a.attr("d",i),e.attr("d",i),ht(),gt(),dt.svg_EV.attr("style","display:none;"),dt.svg_circle_EV.attr("style","display:none;")}var _t={update_clip:ht,update_EV_preview:ft,update_chart:mt,update_text_school:vt,updateMarker:gt,updateMap:yt},Lt={0:d3.interpolateRdYlBu,1:d3.interpolateBuGn,2:d3.interpolateCool};function bt(t){return fetch(t).then(function(t){return t.json()}).then(function(t){return t.data=JSON.parse(t.data),t})}var Ct="https://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.png",Et='&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>';function xt(t){dt.map=L.map(t,{zoomControl:!0});var e=dt.map;e.fitBounds(dt.initialBounds),e.setMaxBounds(e.getBounds());var a=L.tileLayer(Ct,{minZoom:9,maxZoom:14,attribution:Et});a.addTo(e)}function wt(t){return dt.interComm_shape.features.some(function(e){return d3.geoContains(e,t)})}function Pt(t,e){t&&e&&wt([e,t])?dt.map.setView(new L.LatLng(t,e),11):(t=null,e=null,dt.map.fitBounds(dt.initialBounds)),dt.currentGeoLat=t,dt.currentGeoLng=e,_t.updateMarker()}function Vt(t){for(var e=Lt[t],a=[],n=0;n<256;++n)a.push(e(n/255));return a}function kt(t,e,a,n,r){for(var o=200,i=80,s={top:10,right:40,bottom:10,left:2},l=t.attr("height",o-s.top-s.bottom).attr("width",1).style("height",o-s.top-s.bottom+"px").style("width",i-s.left-s.right+"px").style("border","1px solid #000").style("position","absolute").style("top",s.top+"px").style("left",s.left+"px").node(),c=l.getContext("2d"),u=function(t){return a((o-s.top-s.bottom-t)/(o-s.top-s.bottom)*255)},d=c.createImageData(1,o-s.top-s.bottom),p=0;p<o-s.top-s.bottom;++p){var h=d3.rgb(u(p));d.data[4*p]=h.r,d.data[4*p+1]=h.g,d.data[4*p+2]=h.b,d.data[4*p+3]=255}c.putImageData(d,0,0);var f=d3.axisRight().scale(d3.scaleLinear().domain([r,n]).range([1,o-s.bottom-s.top])).tickSize(6).ticks(8),m=e.attr("height",o+"px").attr("width",i+"px").style("position","absolute").style("left","0px").style("top","0px");m.select("g").attr("class","axis").attr("transform","translate("+(i-s.left-s.right+3)+","+s.top+")").call(f)}function St(t,e){var a=t.slice();a.unshift(0),a.push(255);for(var n=a.length,r=e.length,o=[],i=0;i<r;++i)o[i]=i/(r-1);var s=d3.scale.linear().domain(o).range(e),l=[];for(i=0;i<n;++i){var c=i/(n-1);l.push(s(c))}return[a,l]}function jt(t){return{opacity:0,fillOpacity:0}}function It(t){for(var e=[],a=0;a<t;++a)e[a]=a;return e}var Mt={loadContainmentFile:bt,createMap:xt,setLocation:Pt,getColorsFromScheme:Vt,fillScale:kt,computeColorRange:St,blankStyle:jt,range:It},Dt=a("7dc5");function Ot(t,e){var a=dt.canvas,n=dt.voronoi_shape,r=dt.interComm_shape;dt.cachedLayers[t]?e():fetch(t).then(function(t){return t.json()}).then(function(o){o.data=JSON.parse(o.data),o.percentiles=JSON.parse(o.percentiles);var i=o.data;a.width=o.width,a.height=o.height;var s=a.getContext("2d");s.createImageData(a.width,a.height);for(var l=a.height*a.width,c=1,u=0,d=l/c,p=a.height/c,h=[],f=[],m={},v=0;v<n.features.length;++v){f[v]=0,h[v]=0,m[v]=[];for(var g=0;g<256;++g)m[v][g]=0}var y=[],_=[],L={};for(v=0;v<r.features.length;++v){_[v]=0,y[v]=0,L[v]=[];for(g=0;g<256;++g)L[v][g]=0}dt.firstVoronoiByInterComm=[];var b=dt.firstVoronoiByInterComm;for(v=0;v<r.features.length;++v)b[v]=1e4;var C=function(i){for(var l=i.data.result,d=i.data.index,v=i.data.interComm_counts,g=i.data.interComm_means,C=i.data.voronoi_counts,E=i.data.voronoi_means,x=i.data.firstVoronoiByInterComm,w=i.data.voronoi_hist,P=i.data.interComm_hist,V=0;V<n.features.length;++V){f[V]+=C[V],h[V]+=E[V];for(var k=0;k<256;++k)m[V][k]+=w[V][k]}for(V=0;V<r.features.length;++V){_[V]+=v[V],y[V]+=g[V];for(k=0;k<256;++k)L[V][k]+=P[V][k];b[V]>x[V]&&(b[V]=x[V])}if(s.putImageData(l,0,p*d),u++,u==c){if(t==Dt.Ecole_path){for(V=0;V<n.features.length;++V)h[V]/=255;for(V=0;V<r.features.length;++V)y[V]/=255}else{for(V=0;V<n.features.length;++V)0!=f[V]&&(h[V]/=f[V]);for(V=0;V<r.features.length;++V)0!=_[V]&&(y[V]/=_[V])}var S=[70,140],j=a.toDataURL("png");dt.cachedLayers[t]={url:j,tl_lat:o.tl_lat,tl_lng:o.tl_lng,br_lat:o.br_lat,br_lng:o.br_lng,width:a.width,height:a.height,voronoi_means:h,interComm_means:y,voronoi_hist:m,interComm_hist:L,hist_buckets:S,percentiles:o.percentiles,layerUrl:t},e()}},E=Mt.range(256),x=[];if(Dt.layers[t].useColorScheme)x=Mt.getColorsFromScheme(Dt.layers[t].colorScheme);else{var w=Mt.computeColorRange(o.percentiles,Dt.layers[t].colors),P=w[0],V=w[1],k=d3.scale.linear().range(V).domain(P);for(v=0;v<256;++v){var S=d3.rgb(k(v));x.push("rgb("+S.r+","+S.g+","+S.b+")")}}Mt.loadContainmentFile("data/voronoi_cont.json").then(function(t){Mt.loadContainmentFile("data/intercomm_cont.json").then(function(e){for(var l=0;l<c;l++){var u=new Worker("assets/pictureProcessor.js");u.onmessage=C;var h=s.getImageData(0,p*l,a.width,p);u.postMessage({canvasData:h,pixels:i,index:l,length:d,width:a.width,height:a.height,voronoiContainmentData:t.data,interCommContainmentData:e.data,numVoronois:n.features.length,numInterComms:r.features.length,tl_lat:o.tl_lat,tl_lng:o.tl_lng,br_lat:o.br_lat,br_lng:o.br_lng,colorDomain:E,colorRange:x})}})})})}function Tt(t){var e=dt.update_parameters,a=dt.imgs;if(!t)return e.hide=!0,void _t.updateMap();this.loadLayer(t,function(){t==Dt.EV_path?a.attr("clip-path",""):a.attr("clip-path","url(#clip)");var n=dt.cachedLayers[t];e.tl=new L.LatLng(n.tl_lat,n.tl_lng),e.br=new L.LatLng(n.br_lat,n.br_lng),e.currentGeoLat=dt.currentGeoLat,e.currentGaoLng=dt.currentGeoLng;var r=[],o=[];if(Dt.layers[t].useColorScheme)r=Mt.range(256),o=Mt.getColorsFromScheme(Dt.layers[t].colorScheme);else{var i=Mt.computeColorRange(n.percentiles,Dt.layers[t].colors);r=i[0],o=i[1]}var s=d3.scale.linear().range(o).domain(r);dt.voronoi.attr("fill",function(e,a){return t==Dt.EV_path?"#00000011":s(n.voronoi_means[a])}),dt.interComms.attr("fill",function(e,a){return t==Dt.EV_path?"#00000011":s(n.interComm_means[a])}),dt.canvas.width=n.width,dt.canvas.height=n.height,e.hide=!1,_t.updateMap(),dt.currentLayerPath=t,a.attr("xlink:href",n.url),t==Dt.EV_path?d3.select(dt.legend_element).style("display","none").style("border","1px solid #0000"):(Mt.fillScale(dt.color_legend_canvas,dt.color_legend_svg,s,Dt.layers[t].min_value,Dt.layers[t].max_value),d3.select(dt.legend_element).style("background-color","#fff"),d3.select(dt.legend_element).style("display","").style("border","1px solid #000"))})}function Bt(t){dt.imgs_EV.attr("xlink:href",dt.cachedLayers[Dt.EV_path].url)}var Ht={loadLayer:Ot,setLayer:Tt,setEVLayer:Bt},Yt=a("7dc5");function Xt(t){function e(e,a){return dt.firstVoronoiByInterComm[t]<=a&&(t==dt.interComm_shape.features.length-1||dt.firstVoronoiByInterComm[t+1]>a)?1:0}return e}function $t(t,e,a){return t.append("g").selectAll("path").data(dt.voronoi_shape.features).enter().append("path").attr("d",dt.pathGenerator).attr("vector-effect","non-scaling-stroke").style("stroke","#666").style("fill-opacity",e).style("stroke-opacity",e).on("mouseover",function(t,a){d3.select(this).style("fill-opacity",e),dt.defs_path.datum(t.geometry),_t.update_clip(),_t.update_chart(a,dt.currentLayerPath,!0,dt.onHistChange),_t.update_text_school(a,dt.currentLayerPath,!1,dt.onSchools)}).on("mouseout",function(t,e){-1!=dt.highlightedInterComm&&(d3.select(this).style("fill-opacity",Xt(dt.highlightedInterComm)(t,e)),d3.select(this).style("stroke-opacity",Xt(dt.highlightedInterComm)(t,e))),dt.defs_path.datum([]),_t.update_clip(),dt.svg_EV.attr("style","display:none;"),dt.svg_circle_EV.attr("style","display:none;")}).on("dblclick",function(t,n){dt.interComms.style("pointer-events","all"),dt.map.fitBounds(dt.initialBounds),dt.highlightedInterComm=-1,dt.interComms.style("fill-opacity",a),dt.voronoi.style("fill-opacity",e),dt.voronoi.style("stroke-opacity",e),dt.defs_path.datum([]),_t.update_clip(),dt.svg_EV.attr("style","display:none;"),dt.svg_circle_EV.attr("style","display:none;")}).on("mousemove",function(){d3.event&&d3.event.clientX&&d3.event.clientY&&dt.currentLayerPath!=Yt.EV_path?_t.update_EV_preview(d3.event.clientX,d3.event.clientY):(dt.svg_EV.attr("style","display:none;"),dt.svg_circle_EV.attr("style","display:none;"))}).on("mousedown",function(){d3.event&&d3.event.clientX&&d3.event.clientY&&dt.currentLayerPath!=Yt.EV_path&&(dt.lastMouseDownX=d3.event.clientX,dt.lastMouseDownY=d3.event.clientY)})}function zt(t,e,a,n){return t.append("g").selectAll("path").data(dt.interComm_shape.features).enter().append("path").attr("d",dt.path).attr("vector-effect","non-scaling-stroke").style("stroke","#333").attr("fill","#fff").attr("fill-opacity",n).style("pointer-events","all").on("mouseover",function(t,r){-1!=dt.highlightedInterComm?r!=dt.highlightedInterComm?d3.select(this).style("fill-opacity",n):d3.select(this).style("fill-opacity",e):d3.select(this).style("fill-opacity",a),console.log(r),_t.update_chart(r,dt.currentLayerPath,!0),_t.update_text_school(r,dt.currentLayerPath,!1)}).on("mouseout",function(t,r){-1!=dt.highlightedInterComm?r==dt.highlightedInterComm?d3.select(this).style("fill-opacity",e):d3.select(this).style("fill-opacity",a):d3.select(this).style("fill-opacity",n),dt.svg_EV.attr("style","display:none;"),dt.svg_circle_EV.attr("style","display:none;")}).on("click",function(t,n){if(!(!d3.event||!d3.event.clientX||!d3.event.clientY||Math.abs(d3.event.clientX-dt.lastMouseDownX)>=5||Math.abs(d3.event.clientY-dt.lastMouseDownY)>=5)){dt.interComms.style("pointer-events","all"),d3.select(this).style("pointer-events","none"),dt.interComms.style("fill-opacity",a),d3.select(this).style("fill-opacity",e),dt.highlightedInterComm=n,dt.voronoi.style("fill-opacity",Xt(n)),dt.voronoi.style("stroke-opacity",Xt(n));var r=d3.select(this).node().getBBox(),o=dt.map.layerPointToLatLng(L.point(r.x,r.y)),i=dt.map.layerPointToLatLng(L.point(r.x+r.width,r.y+r.height));dt.map.fitBounds(L.latLngBounds(o,i)),dt.svg_EV.attr("style","display:none;"),dt.svg_circle_EV.attr("style","display:none;")}}).on("mousemove",function(){d3.event&&d3.event.clientX&&d3.event.clientY&&dt.currentLayerPath!=Yt.EV_path?_t.update_EV_preview(d3.event.clientX,d3.event.clientY):(dt.svg_EV.attr("style","display:none;"),dt.svg_circle_EV.attr("style","display:none;"))}).on("mousedown",function(){d3.event&&d3.event.clientX&&d3.event.clientY&&dt.currentLayerPath!=Yt.EV_path&&(dt.lastMouseDownX=d3.event.clientX,dt.lastMouseDownY=d3.event.clientY)})}var Gt={defineVoronoi:$t,defineInterComms:zt},At=function(t,e,a,n,r,o,s,l,c){dt.interComm_shape=o,dt.voronoi_shape=s,dt.onHistChange=l,dt.onSchools=c,dt.legend_element=n;var u=new L.LatLng(i.viewport.topLatitude,i.viewport.leftLongitude),d=new L.LatLng(i.viewport.bottomLatitude,i.viewport.rightLongitude);function p(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){Mt.setLocation(t.coords.latitude,t.coords.longitude)})}dt.initialBounds=L.latLngBounds(u,d),dt.color_legend_canvas=d3.select(n).append("canvas"),dt.color_legend_svg=d3.select(n).append("svg"),dt.color_legend_svg.append("g"),p(),Mt.createMap(t),L.geoJson(o,{style:Mt.blankStyle}).addTo(dt.map);var h=d3.select(t).select(".leaflet-zoom-animated");function f(t,e){var a=dt.map.latLngToLayerPoint(new L.LatLng(e,t));this.stream.point(a.x,a.y)}var m=d3.geo.transform({point:f});dt.pathGenerator=d3.geo.path().projection(m);var v=h.append("defs");dt.defs_path=v.append("path").attr("id","clip_path"),v.append("clipPath").attr("id","clip").append("use").attr("xlink:href","#clip_path"),dt.imgs=h.selectAll("image").data([0]).enter().append("svg:image").attr("x",0).attr("y",0).attr("xlink:href","").attr("clip-path",""),_t.update_clip();var g=0,y=.4,_=1;dt.svg_EV=d3.select(e).attr("style","display:none;"),dt.svg_circle_EV=d3.select(a).attr("style","display:none;"),dt.imgs_EV=dt.svg_EV.selectAll("image").data([0]).enter().append("svg:image").attr("x",0).attr("y",0).attr("xlink:href","");var b=dt.svg_EV.append("g");return b.selectAll("path").data([o.features[0]]).enter().append("path").attr("vector-effect","non-scaling-stroke").style("stroke","#000").style("fill-opacity",0).style("stroke-opacity",1),dt.voronoi=Gt.defineVoronoi(h,g,_),dt.interComms=Gt.defineInterComms(h,g,y,_),dt.markerIcon={iconUrl:"assets/marker.png",iconSize:[24,24],iconAnchor:[12,24]},dt.markerElement=h.append("g").selectAll("image").data([0]).enter().append("svg:image").attr("xlink:href",dt.markerIcon.iconUrl).attr("width",dt.markerIcon.iconSize[0]).attr("height",dt.markerIcon.iconSize[1]).attr("visibility","hidden").style("pointer-events","none"),dt.canvas=document.createElement("canvas"),dt.update_parameters={hide:!0},dt.map.on("viewreset",function(){_t.updateMap()}),[Ht.loadLayer,Ht.setLayer,Mt.setLocation,Ht.setEVLayer]},Ft={props:["layers","currentLayerPath","currentLocation","onHist","onSchools","appRefs","onSchools"],data:function(){return{loadLayer:function(){},setLayer:function(){},setLocation:function(){}}},mounted:function(){var t=this,e="data/intercommunalites.geojson",a="data/voronois.json";queue().defer(d3.json,e).defer(d3.json,a).await(function(e,a,n){var r=At(t.$refs.map,t.appRefs.svg,t.appRefs.circle_svg,t.appRefs.legend,e,a,n,t.onHist,t.onSchools),o=Object(T["a"])(r,5);t.loadLayer=o[0],t.setLayer=o[1],t.setLocation=o[2],t.setEVLayer=o[3],t.setTextUrban=o[4],Object.keys(i.layers).forEach(function(e){t.layers[e].path=e,t.loadLayer(e,function(){t.layers[e].loaded=!0,e==i.EV_path&&t.setEVLayer(e)})}),t.setLayer(t.currentLayerPath)})},watch:{currentLayerPath:function(t){this.setLayer(t)},currentLocation:function(t){var e=Object(T["a"])(t,2),a=e[0],n=e[1];this.setLocation(a,n)}}},Rt=Ft,Nt=(a("894b"),Object(d["a"])(Rt,D,O,!1,null,null,null));Nt.options.__file="Map.vue";var Ut=Nt.exports,qt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"sidebar"},[t.currentLayerPath&&t.layers[t.currentLayerPath].loaded?a("div",[a("h2",[t._v(t._s(t.layers[t.currentLayerPath].title))]),a("div",{domProps:{innerHTML:t._s(t.layers[t.currentLayerPath].content)}}),t.currentLayerPath!=t.EV_path?a("Histogram",{attrs:{x:t.currentHistogramX,y:t.currentHistogramY}}):t._e()],1):a("div",{staticClass:"split"},[t._m(0),t._m(1)])])},Jt=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("article",[a("h2",[t._v("Bienvenue sur EcoParis.")]),a("p",[t._v("EcoParis est une visualisation interactive des données cartographiques des services écosystémiques en territoires urbains et péri-urbains en région Ile-de-France issues du projet "),a("a",{attrs:{href:"https://idefese.wordpress.com/"}},[t._v("IDEFESE")]),t._v(".")]),a("p",[t._v("Pour commencer, vous pouvez sélectionner une couche à afficher parmi des mesures de rétention "),a("a",{attrs:{href:"#"}},[t._v("de phosphore")]),t._v(" et "),a("a",{attrs:{href:"#"}},[t._v("d'azote")]),t._v(", des mesures de "),a("a",{attrs:{href:"#"}},[t._v("réduction de la température")]),t._v(" due à la végétation ou encore de "),a("a",{attrs:{href:"#"}},[t._v("valeur économique")]),t._v(" des régions.")]),a("p",[t._v("Vous pouvez aussi choisir d'afficher l'évolution estimée de ces mesures à l'horizon 2025 dans un scénario de changement climatique.")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("article",{staticClass:"about"},[a("p",[t._v("EcoParis a été conçu par des élèves du cours de "),a("a",{attrs:{href:"https://edu.epfl.ch/coursebook/en/data-visualization-COM-480"}},[t._v("Data Visualization")]),t._v(" de l'EPFL, avec l'aide de Perrine Hamel du projet "),a("a",{attrs:{href:"https://naturalcapitalproject.stanford.edu/"}},[t._v("Natural Capital Project")]),t._v(" de Stanford.")]),a("section",{staticClass:"slideshow"},[a("a",{attrs:{href:"https://www.epfl.ch/"}},[a("img",{attrs:{src:"https://mediacom.epfl.ch/files/content/sites/mediacom/files/EPFL-Logo.jpg",alt:"Logo EPFL"}})]),a("a",{attrs:{href:"https://naturalcapitalproject.stanford.edu/"}},[a("img",{attrs:{src:"https://idefese.files.wordpress.com/2018/11/image5.jpg?w=172&h=171",alt:"Logo NatCap"}})])])])}],Zt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"graph",staticClass:"graph-box"})},Wt=[],Kt=function(t){Plotly.react(t.$refs.graph,[{x:t.x,y:t.y,type:"histogram",histfunc:"sum",xbins:{end:256,size:1,start:0}}],{margin:{l:35,r:35,t:5,b:20}},{displayModeBar:!1})},Qt={props:["x","y"],mounted:function(){Kt(this)},watch:{x:function(){Kt(this)}}},te=Qt,ee=(a("cd26"),Object(d["a"])(te,Zt,Wt,!1,null,null,null));ee.options.__file="Histogram.vue";var ae=ee.exports,ne={props:["layers","currentLayerPath","EV_path","currentHistogramX","currentHistogramY"],components:{Histogram:ae}},re=ne,oe=(a("f203"),Object(d["a"])(re,qt,Jt,!1,null,null,null));oe.options.__file="Sidebar.vue";var ie=oe.exports,se=i.EV_path,le={data:function(){return{layers:Object.keys(i.layers).reduce(function(t,e){return t[e]=i.layers[e],t[e].loaded=!1,t[e].path=e,t},{}),currentLayerPath:null,currentLocation:null,currentHistogramX:null,currentHistogramY:null,introVisible:!0,sidebarVisible:!1,defaultLayer:se,EV_path:i.EV_path}},components:{Intro:h,ZoomControl:_,LocationControl:P,Layers:M,Map:Ut,Sidebar:ie}},ce=le,ue=(a("5c0b"),Object(d["a"])(ce,r,o,!1,null,null,null));ue.options.__file="App.vue";var de=ue.exports;n["a"].config.productionTip=!1,new n["a"]({render:function(t){return t(de)}}).$mount("#app")},"58be":function(t,e,a){},"5c0b":function(t,e,a){"use strict";var n=a("5e27"),r=a.n(n);r.a},"5e27":function(t,e,a){},"7dc5":function(t){t.exports={layers:{"data/rasters/espaces_verts.json":{name:"Esp. verts",icon:"E",colorScheme:0,useColorScheme:!1,colors:["#00ff00","#0000ff","#008800"],min_value:0,max_value:0,title:"Espaces verts.",content:"<p>[texte espaces verts]</p>"},"data/rasters/pollination_cc.json":{name:"Phosph.",icon:"P",colorScheme:1,useColorScheme:!0,min_value:0,max_value:5,title:"Mesure de la rétention de phosphore.",content:"<p>Le service de rétention du phosphore permet d'améliorer la qualité de l'eau (superficielle et souterraine). Il est directement utile aux organismes de gestion de l'eau (syndicats et département d'assainissement), et donc aux habitants dont les impôts financent la maintenance des services d'assainissement.</p>"},"data/rasters/T_reduction.json":{name:"Nitrog.",icon:"N",colorScheme:0,useColorScheme:!0,min_value:-5,max_value:5,title:"Mesure de la rétention d'azote.",content:"<p>Le service de rétention de l'azote permet d'améliorer la qualité de l'eau (superficielle et souterraine). Il est directement utile aux organismes de gestion de l'eau (syndicats et département d'assainissement), et donc aux habitants dont les impôts financent la maintenance des services d'assainissement.</p>"},"data/rasters/ecoles_elementaires.json":{name:"Ecoles elementaires",icon:"E",colorScheme:0,useColorScheme:!0,min_value:0,max_value:0,title:"Nombre d'écoles élémentaires et maternelles",content:"<p>Should not appear anyway, find something to fill here.</p>",hidden:!0}},viewport:{topLatitude:49.23719070644322,bottomLatitude:48.12054154281846,leftLongitude:1.44727950476602,rightLongitude:3.555686958558566},EV_path:"data/rasters/espaces_verts.json",Ecole_path:"data/rasters/ecoles_elementaires.json",Urban_cooling:"data/rasters/T_air_ref.json","":"1 - blue-green"}},"894b":function(t,e,a){"use strict";var n=a("a130"),r=a.n(n);r.a},"91fa":function(t,e,a){"use strict";var n=a("a90f"),r=a.n(n);r.a},a130:function(t,e,a){},a90f:function(t,e,a){},bed8:function(t,e,a){"use strict";var n=a("2a3c"),r=a.n(n);r.a},bf1e:function(t,e,a){"use strict";var n=a("d162"),r=a.n(n);r.a},cd26:function(t,e,a){"use strict";var n=a("58be"),r=a.n(n);r.a},d162:function(t,e,a){},f203:function(t,e,a){"use strict";var n=a("0466"),r=a.n(n);r.a},fcd1:function(t,e,a){}});
//# sourceMappingURL=app.3789b55c.js.map